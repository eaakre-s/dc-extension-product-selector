{"version":3,"sources":["store/params/params.actions.js","ProductSelectorError.js","backends/SFCC.js","backends/SFCCCors.js","backends/Hybris.js","backends/CommerceTools.js","backends/KiboCommerce.js","backends/backends.js","store/backend/backend.actions.js","store/pages/pages.actions.js","store/fetching/fetching.actions.js","store/global-error/global-error.actions.js","store/items/items.actions.js","store/initialised/initialised.actions.js","store/selectedItems/selectedItems.actions.js","store/catalog/catalog.actions.js","store/sdk/sdk.actions.js","store/pages/pages.reducer.js","store/params/params.reducer.js","store/store.js","store/sdk/sdk.reducer.js","store/items/items.reducer.js","store/backend/backend.reducer.js","store/touched/touched.reducer.js","store/touched/touched.actions.js","store/fetching/fetching.reducer.js","store/searchText/searchText.reducer.js","store/searchText/searchText.actions.js","store/initialised/initialised.reducer.js","store/catalog/catalog.reducer.js","store/selectedItems/selectedItems.reducer.js","store/global-error/global-error.reducer.js","theme.js","search-box/SearchBox.js","pager/Pager.js","fade-in/FadeIn.js","product/Product.js","catalog-selector/CatalogSelector.js","pagination-summary/PaginationSummary.js","products-grid/ProductsGrid.js","form-error/FormError.js","selected-products/SelectedProducts.js","App.js","index.js"],"names":["setParams","params","type","value","ProductSelectorError","message","code","Error","codes","INVALID_FIELD","INVALID_VALUE","GET_ITEMS","GET_SELECTED_ITEMS","GET_SDK","SFCC","settings","this","state","authSecret","headers","authClientId","endpoint","sfccUrl","ids","site_id","siteId","proxyUrl","queryString","qs","stringify","arrayFormat","method","getHeaders","fetch","trimEnd","response","json","items","console","error","searchText","page","selectedCatalog","emptyResult","numPages","curPage","total","body","search_text","catalog_id","JSON","item","id","SFCCCors","tokens","expires","Date","getTime","authUrl","authToken","btoa","existingToken","tokenExpired","token","Authorization","ok","text","statusText","access_token","expires_in","query","PAGE_SIZE","sfccVersion","getAuth","uri","start","count","expand","select","responseJson","hits","Math","ceil","pageSettings","map","hit","name","get","image","term_query","fields","operator","values","commonSearch","bool_query","must","text_query","search_phrase","Hybris","hybrisUrl","hybrisEndpoint","productService","ProductService","filterIds","currency","getItem","a","catalog","getByCode","itemModel","Promise","all","_get","search","products","pagination","totalResults","currentPage","totalPages","pages","getProductImage","images","find","format","length","url","defaultImageUrl","html","tmp","document","createElement","innerHTML","textContent","innerText","stripHtml","getImage","CommerceTools","host","projectKey","clientId","clientSecret","apiUrl","scope","locale","sdkAuth","SdkAuth","disableRefreshToken","credentials","scopes","clientCredentialsFlow","token_type","log","idsStrings","join","staged","limit","where","results","parseResults","attributes","largeImage","data","key","masterVariant","offset","APIAuthenticationHelper","sharedSecret","authHost","_clientId","_sharedSecret","_authHost","authTicket","undefined","serializedAuth","window","localStorage","parse","authData","kiboAuthTicket","millisecsUntilExpiration","expires_at","now","set","options","_buildFetchOptions","client_id","client_secret","grant_type","_calculateTicketExpiration","_setAuthTicket","refresh_token","refreshedTicket","_getAuthTicket","authenticate","refreshTicket","KiboCommerce","apiHost","graphQLUrl","authHelper","getAccessToken","filter","pageSize","startIndex","variables","request","productSearch","performSearch","result","normalizeItems","totalCount","product","content","productImages","mainImage","imageUrl","productCode","productName","getImageUrl","backends","initBackend","dispatch","getState","backend","getBackend","setBackend","setPage","changePage","getItems","setFetching","setGlobalError","setValue","selectedItems","SDK","field","exportItem","isEmpty","trim","setItems","fetchedItems","setInitialised","addItem","removeItem","setCatalog","setSDK","initalState","catalogs","noItemsText","searchPlaceholderText","rootReducer","combineReducers","action","installation","instance","selectedParams","toLower","touched","isFetching","initialised","reject","oldIndex","newIndex","itemToMove","remainingItems","reorderedItems","slice","globalError","composeEnhancer","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunkMiddleware","theme","createMuiTheme","palette","primary","main","secondary","styles","makeStyles","root","width","marginBottom","spacing","padding","display","alignItems","input","marginLeft","flex","icon","fill","divider","height","margin","debouncedSearch","debounce","e","SearchBox","connect","setSearchText","classes","className","Paper","InputBase","placeholder","inputProps","onChange","event","isUndefined","target","Divider","orientation","Search","marginTop","Pager","allPages","range","take","takeRight","startPages","endPages","ButtonGroup","color","Button","aria-label","onClick","disabled","SkipPrevious","fontSize","ArrowLeft","variant","ArrowRight","SkipNext","FadeIn","show","children","exitOptions","div","initial","opacity","animate","exit","flexDirection","transition","border","isSelected","grey","readOnly","pointerEvents","cardWrapper","thumbnail","paddingBottom","backgroundColor","hasImage","removeBtn","Product","toggleProduct","useState","visible","setVisible","isRemovable","Boolean","form","toggle","hideProduct","useEffect","cardMedia","CardMedia","title","CardAction","IconButton","Clear","cardBody","CardActionArea","Card","raised","CardHeader","subheader","titleTypographyProps","subheaderTypographyProps","minWidth","CatalogSelector","changeCatalog","labelWidth","setLabelWidth","setSelectedCatalog","inputLabel","React","useRef","current","offsetWidth","FormControl","InputLabel","ref","Select","labelId","newCatalog","MenuItem","PaginationSummary","first","last","min","Typography","gridTemplateColumns","justifyContent","loader","ProductsGrid","loading","Grid","container","xs","position","CircularProgress","FormError","FormHelperText","minHeight","boxSizing","overflow","dragItem","fontWeight","zIndex","errorWrapper","alignSelf","textAlign","top","ProductList","isDragging","positionTransition","Loading","NoItems","component","Box","SelectedProducts","reorderItems","indexes","reorder","setDragging","minItems","maxItems","showMinItemError","showMaxItemError","_","sortable","animation","ghostClass","onStart","onEnd","marginRight","App","Warning","Container","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","open","init","getValue","filteredIds","isArray","sortBy","indexOf","updatedParams","frame","startAutoResizer","onReadOnlyChange","Render","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.733f6e7c.chunk.js","sourcesContent":["\r\nexport const SET_PARAMS = 'SET_PARAMS';\r\nexport const setParams = params => ({\r\n  type: SET_PARAMS,\r\n  value: params\r\n});","export class ProductSelectorError extends Error {\r\n  static codes = {\r\n      INVALID_FIELD: 'INVALID_PROPERTY',\r\n      INVALID_VALUE: 'INVALID_VALUE',\r\n      GET_ITEMS: 'GET_ITEMS',\r\n      GET_SELECTED_ITEMS: 'GET_SELECTED_ITEMS',\r\n      GET_SDK: 'GET_SDK'\r\n  }\r\n  code = 'UNDEFINED'\r\n  constructor(message, code) {\r\n    super(message);\r\n    if (code) {\r\n      this.code = code;\r\n    }\r\n  }\r\n}","import qs from 'qs';\r\nimport { trimEnd } from 'lodash';\r\nimport { ProductSelectorError } from '../ProductSelectorError';\r\nexport class SFCC {\r\n  constructor(settings) {\r\n    this.settings = settings;\r\n  }\r\n\r\n  getHeaders(state) {\r\n    const {\r\n      params: { authSecret, authClientId, sfccUrl: endpoint }\r\n    } = state;\r\n    return {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'x-auth-id': authClientId,\r\n        'x-auth-secret': authSecret,\r\n        endpoint\r\n      }\r\n    };\r\n  }\r\n\r\n  async getItems(state, ids) {\r\n    const {\r\n      params: { siteId: site_id, proxyUrl }\r\n    } = state;\r\n    try {\r\n      const queryString = qs.stringify(\r\n        {\r\n          site_id,\r\n          ids\r\n        },\r\n        { arrayFormat: 'brackets' }\r\n      );\r\n      const params = {\r\n        method: 'GET',\r\n        ...this.getHeaders(state)\r\n      };\r\n      params.method = 'GET';\r\n      const response = await fetch(trimEnd(proxyUrl, '/') + '/products?' + queryString, params);\r\n      const { items } = await response.json();\r\n      return items;\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not get items', ProductSelectorError.codes.GET_SELECTED_ITEMS);\r\n    }\r\n  }\r\n\r\n  async search(state) {\r\n    const {\r\n      searchText,\r\n      page,\r\n      selectedCatalog,\r\n      params: { siteId, proxyUrl }\r\n    } = state;\r\n    const emptyResult = { items: [], page: { numPages: 0, curPage: 0, total: 0 } };\r\n\r\n    try {\r\n      const body = {\r\n        site_id: siteId,\r\n        search_text: searchText,\r\n        page: page.curPage\r\n      };\r\n\r\n      if (selectedCatalog !== null) {\r\n        body.catalog_id = selectedCatalog;\r\n      }\r\n      const params = {\r\n        method: 'POST',\r\n        body: JSON.stringify(body),\r\n        ...this.getHeaders(state)\r\n      };\r\n      const response = await fetch(trimEnd(proxyUrl, '/') + '/product-search', params);\r\n      return response.json() || emptyResult;\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not search', ProductSelectorError.codes.GET_ITEMS);\r\n    }\r\n  }\r\n\r\n  exportItem(item) {\r\n    return item.id;\r\n  }\r\n}\r\n","import { ProductSelectorError } from '../ProductSelectorError';\r\nimport { get } from 'lodash';\r\n\r\nexport class SFCCCors {\r\n  constructor(settings) {\r\n    this.settings = settings;\r\n    this.tokens = {};\r\n  }\r\n\r\n  tokenExpired(expires) {\r\n    // Count a token as expired some time before its true expiry time, so that it doesn't expire during use.\r\n    const EXPIRY_BIAS = 300000; // 5 minutes in milliseconds.\r\n    const expired = new Date().getTime() + EXPIRY_BIAS;\r\n    return expired > expires;\r\n  }\r\n\r\n  async getAuth(state) {\r\n    const {\r\n      params: { authSecret, authClientId, authUrl = 'https://account.demandware.com/dw/oauth2/access_token' },\r\n    } = state;\r\n    const authToken = btoa(authClientId + ':' + authSecret);\r\n\r\n    const existingToken = this.tokens[authToken];\r\n    if (existingToken) {\r\n      if (this.tokenExpired(existingToken.expires)) {\r\n        delete this.tokens[authToken];\r\n      } else {\r\n        return existingToken.token;\r\n      }\r\n    }\r\n\r\n    const params = {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: 'Basic ' + authToken,\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: 'grant_type=client_credentials',\r\n    };\r\n\r\n    const response = await fetch(authUrl, params);\r\n    if (!response.ok) {\r\n      throw new Error('Error fetching token', await response.text(), response.statusText);\r\n    }\r\n    const token = await response.json();\r\n\r\n    const ONE_SECOND_IN_MILLISECONDS = 1000;\r\n    this.tokens[authToken] = {\r\n      token: token.access_token,\r\n      expires: new Date().getTime() + token.expires_in * ONE_SECOND_IN_MILLISECONDS,\r\n    };\r\n\r\n    return token.access_token;\r\n  }\r\n\r\n  async commonSearch(state, query) {\r\n    const {\r\n      PAGE_SIZE,\r\n      page,\r\n      params: { siteId, sfccUrl: endpoint, sfccVersion = 'v21_10' },\r\n    } = state;\r\n\r\n    const token = await this.getAuth(state);\r\n\r\n    const emptyResult = { items: [], page: { numPages: 0, curPage: 0, total: 0 } };\r\n\r\n    const apiPath = '/s/-/dw/data/' + sfccVersion;\r\n\r\n    const uri = endpoint + apiPath + '/product_search?site_id=' + siteId;\r\n\r\n    const params = {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: 'Bearer ' + token,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        query,\r\n        start: page.curPage * PAGE_SIZE,\r\n        count: PAGE_SIZE,\r\n        expand: ['images'],\r\n        select: '(**)',\r\n      }),\r\n    };\r\n\r\n    const response = await fetch(uri, params);\r\n    const responseJson = await response.json();\r\n\r\n    if (!responseJson) {\r\n      return emptyResult;\r\n    }\r\n\r\n    const { hits, total } = responseJson;\r\n    let items = [];\r\n    const numPages = Math.ceil(total / PAGE_SIZE);\r\n    const pageSettings = { numPages, curPage: page.curPage, total };\r\n\r\n    if (hits) {\r\n      items = hits.map((hit) => ({\r\n        id: hit.id,\r\n        name: get(hit, 'name.default', null),\r\n        image: get(hit, 'image.abs_url', null),\r\n      }));\r\n    }\r\n\r\n    return { items, page: pageSettings };\r\n  }\r\n\r\n  async getItems(state, ids) {\r\n    const query = {\r\n      term_query: {\r\n        fields: ['id'],\r\n        operator: 'one_of',\r\n        values: ids,\r\n      },\r\n    };\r\n\r\n    try {\r\n      const { items } = await this.commonSearch(state, query);\r\n\r\n      return items;\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not search', ProductSelectorError.codes.GET_SELECTED_ITEMS);\r\n    }\r\n  }\r\n\r\n  async search(state) {\r\n    const { searchText, selectedCatalog } = state;\r\n\r\n    const query = {\r\n      bool_query: {\r\n        must: [\r\n          { text_query: { fields: ['id', 'name'], search_phrase: searchText } },\r\n          { term_query: { fields: ['catalog_id'], operator: 'is', values: selectedCatalog ? [selectedCatalog] : [] } },\r\n        ],\r\n      },\r\n    };\r\n\r\n    try {\r\n      return await this.commonSearch(state, query);\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not search', ProductSelectorError.codes.GET_ITEMS);\r\n    }\r\n  }\r\n\r\n  exportItem(item) {\r\n    return item.id;\r\n  }\r\n}\r\n","import { ProductService } from '@amplience/sap-product-browser';\r\nimport { ProductSelectorError } from '../ProductSelectorError';\r\n\r\nexport class Hybris {\r\n\r\n  constructor({ hybrisUrl, hybrisEndpoint } = {}) {\r\n    this.hybrisUrl = hybrisUrl;\r\n\r\n    if (!hybrisEndpoint) {\r\n      hybrisEndpoint = '/rest/v2';\r\n    }\r\n\r\n    this.hybrisEndpoint = hybrisEndpoint;\r\n\r\n    this.productService = new ProductService(hybrisUrl, hybrisEndpoint, null);\r\n  }\r\n\r\n  async getItems(state, filterIds) {\r\n    const { params } = state;\r\n    const { currency } = params;\r\n\r\n    const getItem = async ({id, catalog}) => {\r\n      const item = await this.productService.getByCode(catalog, id, currency);\r\n\r\n      return this.itemModel(item, catalog);\r\n    };\r\n\r\n    try {\r\n      return Promise.all(filterIds.map(getItem));\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not get items', ProductSelectorError.codes.GET_SELECTED_ITEMS);\r\n    }\r\n  }\r\n\r\n  async search(state) {\r\n    try {\r\n      const { items, page } = await this._get(state);\r\n\r\n      return {\r\n        items,\r\n        page\r\n      };\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not get items', ProductSelectorError.codes.GET_ITEMS);\r\n    }\r\n  }\r\n\r\n  async _get(state) {\r\n    const { selectedCatalog, searchText, page, params } = state;\r\n    const { currency } = params;\r\n\r\n    const { products, pagination } = await this.productService.search(\r\n      selectedCatalog,\r\n      searchText,\r\n      currency,\r\n      page.curPage\r\n    );\r\n\r\n    const { totalResults: total, currentPage: curPage, totalPages: numPages } = pagination;\r\n\r\n    const pages = {\r\n      total,\r\n      curPage,\r\n      numPages\r\n    };\r\n\r\n    const items = products.map(item => this.itemModel(item, selectedCatalog));\r\n\r\n    return { items, page: pages };\r\n  }\r\n\r\n  getImage(item) {\r\n    const getProductImage = ({ images }) => images.find(({ format }) => format === 'product');\r\n    return item.images && item.images.length && getProductImage(item)\r\n      ? this.hybrisUrl + getProductImage(item).url\r\n      : item.defaultImageUrl;\r\n  }\r\n\r\n  stripHtml(html) {\r\n    const tmp = document.createElement('DIV');\r\n    tmp.innerHTML = html;\r\n    return tmp.textContent || tmp.innerText || '';\r\n  }\r\n\r\n  itemModel({ code, name, images, defaultImageUrl }, catalog) {\r\n    return {\r\n      id: code,\r\n      name: this.stripHtml(name),\r\n      image: this.getImage({ images, defaultImageUrl }),\r\n      catalog\r\n    };\r\n  }\r\n\r\n  exportItem({ id, catalog }) {\r\n    return {\r\n      id,\r\n      catalog\r\n    };\r\n  }\r\n}\r\n","import SdkAuth from '@commercetools/sdk-auth'\r\nimport {ProductSelectorError} from '../ProductSelectorError';\r\nimport qs from 'qs';\r\n\r\nexport class CommerceTools {\r\n  constructor({host, projectKey, clientId, clientSecret, apiUrl, scope = 'view_published_products', locale}) {\r\n\r\n    this.sdkAuth = new SdkAuth({\r\n      host,\r\n      projectKey,\r\n      disableRefreshToken: false,\r\n      credentials: {\r\n        clientId,\r\n        clientSecret,\r\n      },\r\n      scopes: [scope + ':' + projectKey],\r\n    });\r\n\r\n    this.apiUrl = apiUrl;\r\n    this.locale = locale;\r\n  }\r\n\r\n  async getHeaders() {\r\n    this.token = await this.sdkAuth.clientCredentialsFlow();\r\n    const {\r\n      token_type, access_token\r\n    } = this.token;\r\n\r\n    return {\r\n      headers: {\r\n        'Authorization': `${token_type} ${access_token}`\r\n      }\r\n    };\r\n  }\r\n\r\n  async getItems(state, filterIds = []) {\r\n    const {\r\n      PAGE_SIZE,\r\n      params: {\r\n        projectKey\r\n      }\r\n    } = state;\r\n    try {\r\n      if (!filterIds.length){\r\n        return [];\r\n      }\r\n      \r\n      console.log('getItems-filterIds', filterIds);\r\n      const headers = await this.getHeaders();\r\n      const idsStrings = '\"' + filterIds.join('\",\"') + '\"';\r\n\r\n      const params = {\r\n        method: 'GET',\r\n        ...headers\r\n      };\r\n\r\n      console.log('getItems-ids', idsStrings);\r\n      const queryString = qs.stringify(\r\n        {\r\n          staged: false,\r\n          limit: PAGE_SIZE,\r\n          where: `id in (${idsStrings})`\r\n        }\r\n      );\r\n\r\n      console.log('getItems-queryString', queryString)\r\n      \r\n      const response = await fetch(`${this.apiUrl}/${projectKey}/product-projections?${queryString}`, params);\r\n      const {results} = await response.json();\r\n\r\n      console.log('getItems-results', results)\r\n      return this.parseResults(results);\r\n\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not get items', ProductSelectorError.codes.GET_SELECTED_ITEMS);\r\n    }\r\n  }\r\n\r\n  getImage({ attributes = [], images = [] }) {\r\n    const LARGE_IMAGE_KEY = 'largeImageUrl';\r\n    const largeImage = attributes.find(({ name = '' }) => name === LARGE_IMAGE_KEY);\r\n\r\n    if (largeImage && largeImage.value) {\r\n      return largeImage.value;\r\n    }\r\n\r\n    return images.length ? images[0].url : '';\r\n  }\r\n\r\n  parseResults(data) {\r\n    return data.map((item) => {\r\n      console.log('parseResults-item', item)\r\n\r\n      return {\r\n        id: item.id,\r\n        key: item.key, \r\n        name: item.name[this.locale],\r\n        image: this.getImage(item.masterVariant)\r\n      }\r\n    })\r\n  }\r\n\r\n  async search(state) {\r\n    const {\r\n      searchText,\r\n      page,\r\n      PAGE_SIZE,\r\n      params: {projectKey}\r\n    } = state;\r\n\r\n    try {\r\n      const headers = await this.getHeaders();\r\n\r\n      const params = {\r\n        method: 'GET',\r\n        ...headers\r\n      };\r\n\r\n      const queryString = qs.stringify(\r\n        {\r\n          staged: false,\r\n          offset: page.curPage * PAGE_SIZE,\r\n          limit: PAGE_SIZE,\r\n          [`text.${this.locale}`]: searchText\r\n        }\r\n      );\r\n\r\n      const response = await fetch(`${this.apiUrl}/${projectKey}/product-projections/search?${queryString}`, params);\r\n      const {results, total} = await response.json();\r\n\r\n      return {\r\n        items: this.parseResults(results),\r\n        page: {\r\n          numPages: Math.ceil(total / PAGE_SIZE),\r\n          curPage: page.curPage,\r\n          total\r\n        }\r\n      };\r\n    } catch (e) {\r\n      console.error(e);\r\n      throw new ProductSelectorError('Could not search', ProductSelectorError.codes.GET_ITEMS);\r\n    }\r\n  }\r\n\r\n  exportItem(item) {\r\n    console.log('exportItem-item', item)\r\n    return {\r\n      value: item.id,\r\n      key: item.key,\r\n    };\r\n  }\r\n}\r\n","import { ProductSelectorError } from '../ProductSelectorError';\r\n\r\nexport const productSearchQuery = /* GraphQL */ `\r\n  query Search($query: String, $filter: String, $pageSize: Int, $startIndex: Int) {\r\n    productSearch(query: $query, filter: $filter, pageSize: $pageSize, startIndex: $startIndex) {\r\n      items {\r\n        productCode\r\n        content {\r\n          productName\r\n          productImages {\r\n            imageUrl\r\n          }\r\n        }\r\n      }\r\n      totalCount\r\n      pageSize\r\n      startIndex\r\n    }\r\n  }\r\n`;\r\n\r\nexport class APIAuthenticationHelper {\r\n  constructor(clientId, sharedSecret, authHost) {\r\n    this._clientId = clientId;\r\n    this._sharedSecret = sharedSecret;\r\n    this._authHost = authHost;\r\n    let authTicket = undefined;\r\n    try {\r\n      let serializedAuth = window.localStorage.get('kibo-at');\r\n      if (serializedAuth) {\r\n        authTicket = JSON.parse(serializedAuth);\r\n      }\r\n    } catch (error) {}\r\n    this.authData = authTicket;\r\n  }\r\n\r\n  _buildFetchOptions(data) {\r\n    return {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(data),\r\n    };\r\n  }\r\n\r\n  _calculateTicketExpiration(kiboAuthTicket) {\r\n    //calculate how many milliseconds until auth expires\r\n    const millisecsUntilExpiration = kiboAuthTicket.expires_in * 1000;\r\n    kiboAuthTicket.expires_at = Date.now() + millisecsUntilExpiration;\r\n    return kiboAuthTicket;\r\n  }\r\n\r\n  async _getAuthTicket() {\r\n    return this.authData;\r\n  }\r\n\r\n  async _setAuthTicket(kiboAuthTicket) {\r\n    try {\r\n      window.localStorage.set('kibo-at', JSON.stringify(kiboAuthTicket));\r\n    } catch (error) {}\r\n    this.authData = { ...kiboAuthTicket };\r\n  }\r\n\r\n  async authenticate() {\r\n    // create oauth fetch options\r\n    const options = this._buildFetchOptions({\r\n      client_id: this._clientId,\r\n      client_secret: this._sharedSecret,\r\n      grant_type: 'client_credentials',\r\n    });\r\n    // perform authentication\r\n    const authTicket = await (\r\n      await fetch(`https://${this._authHost}/api/platform/applications/authtickets/oauth`, options)\r\n    ).json();\r\n    // set expiration time in ms on auth ticket\r\n    this._calculateTicketExpiration(authTicket);\r\n    // set authentication ticket on next server runtime object\r\n    await this._setAuthTicket(authTicket);\r\n\r\n    return authTicket;\r\n  }\r\n\r\n  async refreshTicket(kiboAuthTicket) {\r\n    // create oauth refresh fetch options\r\n    const options = this._buildFetchOptions({\r\n      client_id: this._clientId,\r\n      client_secret: this._sharedSecret,\r\n      grant_type: 'client_credentials',\r\n      refresh_token: kiboAuthTicket && kiboAuthTicket.refresh_token,\r\n    });\r\n    const refreshedTicket = await (\r\n      await fetch(`https://${this._authHost}/api/platform/applications/authtickets/oauth`, options)\r\n    ).json();\r\n\r\n    this._calculateTicketExpiration(refreshedTicket);\r\n\r\n    await this._setAuthTicket(refreshedTicket);\r\n\r\n    return refreshedTicket;\r\n  }\r\n\r\n  async getAccessToken() {\r\n    // get current Kibo API auth ticket\r\n\r\n    let authTicket = await this._getAuthTicket();\r\n    // if no current ticket, perform auth\r\n    // or if ticket expired, refresh auth\r\n    if (!authTicket) {\r\n      authTicket = await this.authenticate();\r\n    } else if (authTicket.expires_at < Date.now()) {\r\n      authTicket = await this.refreshTicket(authTicket);\r\n    }\r\n\r\n    return authTicket.access_token;\r\n  }\r\n}\r\n\r\nexport class KiboCommerce {\r\n  constructor({ apiHost, authHost, clientId, sharedSecret }) {\r\n    this.graphQLUrl = `https://${apiHost}/graphql`;\r\n    this.authHelper = new APIAuthenticationHelper(clientId, sharedSecret, authHost);\r\n  }\r\n\r\n  async getAccessToken() {\r\n    return await this.authHelper.getAccessToken();\r\n  }\r\n\r\n  async getHeaders() {\r\n    const authToken = await this.getAccessToken();\r\n    return {\r\n      headers: {\r\n        Authorization: `Bearer ${authToken}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    };\r\n  }\r\n\r\n  async performSearch({ query, filter, pageSize, startIndex }) {\r\n    const headers = await this.getHeaders();\r\n    const body = {\r\n      query: productSearchQuery,\r\n      variables: { query, filter, pageSize, startIndex },\r\n    };\r\n    const params = { method: 'POST', ...headers, body: JSON.stringify(body) };\r\n    const request = await fetch(this.graphQLUrl, params);\r\n    const response = await request.json();\r\n    return response.data.productSearch;\r\n  }\r\n\r\n  async getItems(state, ids = []) {\r\n    const { PAGE_SIZE } = state;\r\n    const filter = ids.map((id) => `productCode eq ${id}`).join(' or ');\r\n    try {\r\n      const result = await this.performSearch({ filter, pageSize: PAGE_SIZE });\r\n      return this.normalizeItems(result.items);\r\n    } catch (error) {\r\n      console.error(error);\r\n      throw new ProductSelectorError('Could not get items', ProductSelectorError.codes.GET_SELECTED_ITEMS);\r\n    }\r\n  }\r\n\r\n  async search(state) {\r\n    const { searchText, page, PAGE_SIZE } = state;\r\n    try {\r\n      const startIndex = (page.curPage || 0) * PAGE_SIZE;\r\n      const result = await this.performSearch({ query: searchText, pageSize: PAGE_SIZE, startIndex });\r\n      if (!result.totalCount) {\r\n        return {\r\n          items: [],\r\n          page: { numPages: 0, curPage: 0, total: 0 },\r\n        };\r\n      }\r\n      return {\r\n        items: this.normalizeItems(result.items),\r\n        page: {\r\n          numPages: Math.ceil(result.totalCount / PAGE_SIZE),\r\n          curPage: page.curPage,\r\n          total: result.totalCount,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      console.error(error);\r\n      throw new ProductSelectorError('Could not search', ProductSelectorError.codes.GET_ITEMS);\r\n    }\r\n  }\r\n\r\n  exportItem(item) {\r\n    return item.id;\r\n  }\r\n\r\n  getImageUrl(product) {\r\n    const { content = {} } = product;\r\n    const { productImages = [] } = content;\r\n    const mainImage = productImages[0];\r\n    return mainImage ? mainImage.imageUrl : '';\r\n  }\r\n\r\n  normalizeItems(items = []) {\r\n    return items.map((product) => ({\r\n      id: product.productCode,\r\n      name: product.content.productName,\r\n      image: this.getImageUrl(product),\r\n    }));\r\n  }\r\n}\r\n","import { SFCC } from './SFCC';\r\nimport { SFCCCors } from './SFCCCors';\r\nimport { Hybris } from './Hybris';\r\nimport { CommerceTools } from './CommerceTools';\r\nimport { KiboCommerce } from './KiboCommerce';\r\nexport const backends = {\r\n  SFCC: 'sfcc',\r\n  SFCCCORS: 'sfcc-cors',\r\n  HYBRIS: 'hybris',\r\n  COMMERCETOOLS: 'commercetools',\r\n  KIBOCOMMERCE: 'kibocommerce',\r\n};\r\n\r\nexport const getBackend = (params) => {\r\n  switch (params.backend) {\r\n    case backends.HYBRIS:\r\n      return new Hybris(params);\r\n    case backends.COMMERCETOOLS:\r\n      return new CommerceTools(params);\r\n    case backends.KIBOCOMMERCE:\r\n      return new KiboCommerce(params);\r\n    case backends.SFCCCORS:\r\n      return new SFCCCors(params);\r\n    case backends.SFCC:\r\n    default:\r\n      return new SFCC(params);\r\n  }\r\n};\r\n","import { getBackend } from '../../backends/backends';\r\n\r\nexport const SET_BACKEND = 'SET_BACKEND';\r\nexport const INIT_BACKEND = 'INIT_BACKEND';\r\n\r\nexport const initBackend = () => (dispatch, getState) => {\r\n  const { params } = getState();\r\n  const backend = getBackend(params);\r\n\r\n  console.log('params', params)\r\n  console.log('backend', backend);\r\n  console.log('dispatch', dispatch);\r\n  \r\n  dispatch(setBackend(backend));\r\n};\r\n\r\nexport const setBackend = value => ({\r\n  type: SET_BACKEND,\r\n  value\r\n});\r\n","import { getItems } from \"../items/items.actions\";\r\n\r\nexport const SET_PAGE = 'SET_PAGE';\r\nexport const setPage = value => ({\r\n  type: SET_PAGE,\r\n  value\r\n});\r\n\r\nexport const changePage = curPage => async (dispatch, getState) => {\r\n  const { page } = getState();\r\n  dispatch(setPage({...page, curPage }));\r\n  dispatch(getItems());\r\n}\r\n\r\n","export const SET_FETCHING = 'SET_FETCHING';\r\n\r\nexport const setFetching = value => ({\r\n  type: SET_FETCHING,\r\n  value\r\n});","export const SET_GLOBAL_ERROR = 'SET_GLOBAL_ERROR';\r\n\r\nexport const setGlobalError = value => ({\r\n  type: SET_GLOBAL_ERROR,\r\n  value\r\n});","import { map, trim, isEmpty, get } from 'lodash';\r\nimport { setPage } from '../pages/pages.actions';\r\nimport { setFetching } from '../fetching/fetching.actions';\r\nimport { setGlobalError } from '../global-error/global-error.actions';\r\n\r\nexport const SET_VALUE = 'SET_VALUE';\r\n\r\nexport const setValue = selectedItems => async (dispatch, getState) => {\r\n  const { SDK, backend } = getState();\r\n  try {\r\n    console.log('itemsActions-setValue', selectedItems);\r\n    await SDK.field.setValue(map(selectedItems, item => backend.exportItem(item.key)));\r\n  } catch (e) {\r\n    console.log('setValue-error', e)\r\n    const error = get(e, '[0].data.keyword');\r\n    if (!error) {\r\n      dispatch(setGlobalError('Could not set value'));\r\n    }\r\n  }\r\n};\r\n\r\nexport const GET_ITEMS = 'GET_ITEMS';\r\n\r\nexport const getItems = () => async (dispatch, getState) => {\r\n  const state = getState();\r\n\r\n  if (isEmpty(trim(state.searchText))) {\r\n    const page = {\r\n      numPages: 0,\r\n      curPage: 0,\r\n      total: 0\r\n    };\r\n    dispatch(setPage(page));\r\n    dispatch(setItems([]));\r\n    return;\r\n  }\r\n\r\n  dispatch(setFetching(true));\r\n\r\n  let items = [];\r\n\r\n  try {\r\n    const { items: fetchedItems, page } = await state.backend.search(state);\r\n    items = fetchedItems;\r\n    dispatch(setPage(page));\r\n    dispatch(setItems(items));\r\n  } catch (e) {\r\n    dispatch(setGlobalError('Could not get items'));\r\n    console.error(e)\r\n  }\r\n\r\n  dispatch(setFetching(false));\r\n};\r\n\r\nexport const SET_ITEMS = 'SET_ITEMS';\r\n\r\nexport const setItems = value => ({\r\n  type: SET_ITEMS,\r\n  value\r\n});\r\n","export const SET_INITIALISED = 'SET_INITIALISED';\r\n\r\nexport const setInitialised = value => ({\r\n  type: SET_INITIALISED,\r\n  value\r\n});\r\n","import sortBy from 'lodash/sortBy';\r\nimport filter from 'lodash/filter';\r\nimport isEmpty from 'lodash/isEmpty';\r\nimport indexOf from 'lodash/indexOf';\r\nimport isArray from 'lodash/isArray';\r\n\r\nimport { setValue } from '../items/items.actions';\r\nimport { setFetching } from '../fetching/fetching.actions';\r\nimport { setInitialised } from '../initialised/initialised.actions';\r\nimport { ProductSelectorError } from '../../ProductSelectorError';\r\nimport { setTouched } from '../touched/touched.actions';\r\nimport { setGlobalError } from '../global-error/global-error.actions';\r\n\r\nexport const GET_SELECTED_ITEMS = 'GET_SELECTED_ITEMS';\r\nexport const SET_SELECTED_ITEMS = 'SET_SELECTED_ITEMS';\r\nexport const REMOVE_SELECTED_ITEM = 'REMOVE_SELECTED_ITEM';\r\nexport const ADD_SELECTED_ITEM = 'ADD_SELECTED_ITEM';\r\nexport const REORDER_SELECTED_ITEMS = 'REORDER_SELECTED_ITEM';\r\n\r\nexport const addItem = item => ({\r\n  type: ADD_SELECTED_ITEM,\r\n  value: item\r\n});\r\n\r\nexport const removeItem = item => ({\r\n  type: REMOVE_SELECTED_ITEM,\r\n  value: item\r\n});\r\n\r\nexport const setSelectedItems = value => ({\r\n  type: SET_SELECTED_ITEMS,\r\n  value\r\n});\r\n\r\nexport const reorder = indexes => ({\r\n  type: REORDER_SELECTED_ITEMS,\r\n  value: indexes\r\n});\r\n\r\nexport const toggleProduct = (item, isSelected) => async (dispatch, getState) => {\r\n  \r\n  console.log('toggleProduct', item, isSelected);\r\n  dispatch(isSelected ? removeItem(item) : addItem(item));\r\n  dispatch(setTouched(true));\r\n\r\n  const { selectedItems } = getState();\r\n\r\n  dispatch(setValue(selectedItems));\r\n};\r\n\r\nexport const reorderItems = indexes => (dispatch, getState) => {\r\n  dispatch(reorder(indexes));\r\n  const { selectedItems } = getState();\r\n  dispatch(setValue(selectedItems));\r\n};\r\n\r\nexport const getSelectedItems = () => async (dispatch, getState) => {\r\n  const state = getState();\r\n  const { SDK, backend } = state;\r\n\r\n  dispatch(setFetching(true));\r\n\r\n  let selectedItems = [];\r\n\r\n  try {\r\n    const ids = await SDK.field.getValue();\r\n    console.log('getSelectedItems-ids', ids)\r\n    const filteredIds = filter(ids, item => !isEmpty(item));\r\n    console.log('getSelectedItems-filteredIds', filteredIds)\r\n\r\n    if (filteredIds && filteredIds.length) {\r\n      const items = await backend.getItems(state, filteredIds);\r\n\r\n      if (!isArray(items)) {\r\n        throw new ProductSelectorError('Field value is not an array', ProductSelectorError.codes.INVALID_VALUE);\r\n      }\r\n\r\n      selectedItems = items;\r\n      console.log('getSelectedItems-selectedItems', selectedItems)\r\n    }\r\n\r\n    selectedItems = sortBy(selectedItems, ({ id }) => indexOf(ids, id));\r\n\r\n    console.log('before-SetValue')\r\n    if (selectedItems.length !== ids.length) {\r\n      dispatch(setValue(selectedItems));\r\n    }\r\n    console.log('before-setSelectedItems')\r\n\r\n    dispatch(setSelectedItems(selectedItems));\r\n    console.log('before-setFetching')\r\n\r\n    dispatch(setFetching(false));\r\n    dispatch(setInitialised(true));\r\n  } catch (e) {\r\n    console.error('could not load', e);\r\n    dispatch(setFetching(false));\r\n    dispatch(setInitialised(true));\r\n    dispatch(setGlobalError('Could not get selected items'));\r\n  }\r\n};\r\n","import { changePage } from \"../pages/pages.actions\";\r\n\r\nexport const SET_CATALOG = 'SET_CATALOG';\r\n\r\nexport const setCatalog = value => ({\r\n  type: SET_CATALOG,\r\n  value\r\n});\r\n\r\nexport const changeCatalog = value => async dispatch => {\r\n  dispatch(setCatalog(value));\r\n  dispatch(changePage(0));\r\n}","import { init } from \"dc-extensions-sdk\";\r\nimport { setParams } from \"../params/params.actions\";\r\nimport { initBackend } from '../backend/backend.actions';\r\nimport { getSelectedItems } from '../selectedItems/selectedItems.actions';\r\nimport { setFetching } from '../fetching/fetching.actions';\r\nimport { setGlobalError } from '../global-error/global-error.actions';\r\nimport { setCatalog } from '../catalog/catalog.actions';\r\nimport { setInitialised } from \"../initialised/initialised.actions\";\r\n\r\nexport const SET_SDK = 'SET_SDK';\r\n\r\nexport const setSDK = value => ({\r\n  type: SET_SDK,\r\n  value\r\n});\r\n\r\nexport const fetchSDK = () => async (dispatch, getState) => {\r\n  let { SDK } = getState();\r\n\r\n  if (SDK) {\r\n    return SDK;\r\n  }\r\n\r\n  dispatch(setFetching(true));\r\n\r\n  try {\r\n    SDK = await init();\r\n\r\n    console.log('fetchSDK-sdk', SDK)\r\n    dispatch(setSDK(SDK));\r\n    console.log('fetchSDK-params', SDK.params)\r\n\r\n    dispatch(setParams(SDK.params));\r\n    dispatch(initBackend());\r\n    const {params} = getState();\r\n    \r\n    if (params.catalogs.length) {\r\n      dispatch(setCatalog(params.catalogs[0].id));\r\n    }\r\n    dispatch(getSelectedItems());\r\n    const {params: updatedParams} = getState();\r\n    \r\n    if (updatedParams.catalogs.length !== params.catalogs.length) {\r\n      dispatch(setCatalog(updatedParams.catalogs[0].id));\r\n    }\r\n    dispatch(setFetching(false));\r\n    SDK.frame.startAutoResizer();\r\n    SDK.form.onReadOnlyChange(readOnly => {\r\n      dispatch(setSDK({ ...SDK, form: { ...SDK.form, readOnly } }))\r\n    })\r\n  }\r\n  catch (e) {\r\n    console.error('Failed to load', e);    \r\n    dispatch(setFetching(false));\r\n    dispatch(setInitialised(true));\r\n    dispatch(setGlobalError('Could not get SDK'));\r\n  }\r\n\r\n\r\n  return SDK;\r\n}","import { SET_PAGE } from \"./pages.actions\";\r\n\r\nconst initalState = {\r\n  numPages: 0,\r\n  curPage: 0,\r\n  total: 0\r\n};\r\n\r\nexport function pagesReducer(state = initalState, action) {\r\n  switch (action.type) {\r\n    case SET_PAGE:\r\n      return {...state, ...action.value};\r\n    default:\r\n      return state;\r\n  }\r\n}","import { toLower } from 'lodash';\r\nimport { SET_PARAMS } from \"./params.actions\";\r\n\r\nexport const params = {\r\n  proxyUrl: '',\r\n  sfccUrl: '',\r\n  authSecret: '',\r\n  authClientId: '',\r\n  siteId: '',\r\n  currency: 'USD',\r\n  catalogs: [],\r\n  backend: 'SFCC',\r\n  noItemsText: 'No items selected.',\r\n  searchPlaceholderText: 'Search'\r\n};\r\n\r\nexport function paramReducer(state = params, {type, value}) {\r\n  switch (type) {\r\n    case SET_PARAMS:\r\n      const {installation, instance} = (value || {});\r\n      const selectedParams = {...installation, ...instance};\r\n      return {...state, ...selectedParams, backend: toLower(selectedParams.backend)};\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import thunkMiddleware from 'redux-thunk';\r\n\r\nimport { createStore, applyMiddleware, combineReducers, compose } from 'redux';\r\n\r\nimport { sdkReducer } from './sdk/sdk.reducer';\r\nimport { pagesReducer } from './pages/pages.reducer'\r\nimport { itemsReducer } from './items/items.reducer';\r\nimport { paramReducer } from './params/params.reducer';\r\nimport { backendReducer } from './backend/backend.reducer';\r\nimport { touchedReducer } from './touched/touched.reducer';\r\nimport { catalogReducer } from './catalog/catalog.reducer';\r\nimport { fetchingReducer } from './fetching/fetching.reducer';\r\nimport { searchTextReducer } from './searchText/searchText.reducer';\r\nimport { initialisedReducer } from './initialised/initialised.reducer';\r\nimport { selectedItemsReducer } from './selectedItems/selectedItems.reducer';\r\nimport { globalErrorReducer } from './global-error/global-error.reducer';\r\n\r\nexport const rootReducer = combineReducers({\r\n  SDK: sdkReducer,\r\n  page: pagesReducer,\r\n  items: itemsReducer,\r\n  params: paramReducer,\r\n  backend: backendReducer,\r\n  touched: touchedReducer,\r\n  isFetching: fetchingReducer,\r\n  searchText: searchTextReducer,\r\n  initialised: initialisedReducer,\r\n  selectedCatalog: catalogReducer,\r\n  selectedItems: selectedItemsReducer,\r\n  globalError: globalErrorReducer,\r\n  PAGE_SIZE: (state = 20) => state,\r\n});\r\n\r\nconst composeEnhancer = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nexport const store = createStore(\r\n  rootReducer,\r\n  composeEnhancer(applyMiddleware(thunkMiddleware))\r\n);\r\n","import { SET_SDK } from \"./sdk.actions\";\r\n\r\nexport function sdkReducer(state = null, action) {\r\n  switch(action.type) {\r\n    case SET_SDK:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}","import { SET_ITEMS } from \"./items.actions\";\r\n\r\nexport function itemsReducer(state = [], action) {\r\n  switch (action.type) {\r\n    case SET_ITEMS:\r\n      return action.value;\r\n      \r\n    default:\r\n      return state;\r\n  }\r\n}","import { SET_BACKEND } from \"./backend.actions\";\r\n\r\nexport function backendReducer(state = {}, action) {\r\n  switch (action.type) {\r\n    case SET_BACKEND:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { SET_TOUCHED } from \"./touched.actions\";\r\n\r\nexport function touchedReducer(state = false, action) {\r\n  switch (action.type) {\r\n    case SET_TOUCHED:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}","export const SET_TOUCHED = 'SET_TOUCHED';\r\nexport const setTouched = value => ({\r\n  type: SET_TOUCHED,\r\n  value\r\n});","import { SET_FETCHING } from \"./fetching.actions\";\r\n\r\nexport function fetchingReducer(state = false, action) {\r\n  switch (action.type) {\r\n    case SET_FETCHING:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}","import { SET_SEARCH_TEXT } from \"./searchText.actions\";\r\n\r\nexport function searchTextReducer(state = '', action) {\r\n  switch (action.type) {\r\n    case SET_SEARCH_TEXT:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}","export const SET_SEARCH_TEXT = 'SET_SEARCH_TEXT';\r\n\r\nexport const setSearchText = value => ({\r\n  type: SET_SEARCH_TEXT,\r\n  value\r\n});\r\n","import { SET_INITIALISED } from \"./initialised.actions\";\r\n\r\nexport function initialisedReducer(state = false, action) {\r\n  switch (action.type) {\r\n    case SET_INITIALISED:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}","import { SET_CATALOG } from './catalog.actions';\r\n\r\nexport function catalogReducer(state = null, action) {\r\n  switch (action.type) {\r\n    case SET_CATALOG:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { reject, slice } from 'lodash';\r\n\r\nimport {\r\n  SET_SELECTED_ITEMS,\r\n  REMOVE_SELECTED_ITEM,\r\n  ADD_SELECTED_ITEM,\r\n  REORDER_SELECTED_ITEMS\r\n} from './selectedItems.actions';\r\n\r\nexport function selectedItemsReducer(state = [], action) {\r\n  switch (action.type) {\r\n    case SET_SELECTED_ITEMS:\r\n      return action.value;\r\n    case REMOVE_SELECTED_ITEM:\r\n      return reject(state, { id: action.value.id });\r\n    case ADD_SELECTED_ITEM:\r\n      return [...state, action.value];\r\n    case REORDER_SELECTED_ITEMS:\r\n      const { oldIndex, newIndex } = action.value;\r\n      const itemToMove = state[oldIndex];\r\n      const remainingItems = reject(state, { id: itemToMove.id });\r\n      const reorderedItems = [...slice(remainingItems, 0, newIndex), itemToMove, ...slice(remainingItems, newIndex)];\r\n\r\n      return reorderedItems;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { SET_GLOBAL_ERROR } from './global-error.actions';\r\n\r\nexport function globalErrorReducer(state = null, action) {\r\n  switch (action.type) {\r\n    case SET_GLOBAL_ERROR:\r\n      return action.value;\r\n    default:\r\n      return state;\r\n  }\r\n}","import { createMuiTheme } from '@material-ui/core/styles';\r\n\r\nexport const theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#039be5'\r\n    },\r\n    secondary: {\r\n      main: '#1ab0f9'\r\n    },\r\n    error: {\r\n      main: '#ff3366'\r\n    }\r\n  }\r\n});","import React from 'react';\r\nimport { debounce, isUndefined, trim } from 'lodash';\r\nimport { connect } from 'react-redux';\r\nimport { Paper, InputBase, Divider, makeStyles } from '@material-ui/core';\r\nimport { Search } from '@material-ui/icons';\r\nimport { changePage } from '../store/pages/pages.actions';\r\nimport { setSearchText } from '../store/searchText/searchText.actions';\r\nimport { setGlobalError } from '../store/global-error/global-error.actions';\r\n\r\nconst styles = makeStyles(theme => ({\r\n  root: {\r\n    width: '100%',\r\n    marginBottom: theme.spacing(2)\r\n  },\r\n  search: {\r\n    padding: '2px 4px',\r\n    display: 'flex',\r\n    alignItems: 'center'\r\n  },\r\n  input: {\r\n    marginLeft: theme.spacing(1),\r\n    flex: 1\r\n  },\r\n  icon: {\r\n    padding: 10,\r\n    fill: 'rgba(0, 0, 0, 0.54)'\r\n  },\r\n  divider: {\r\n    height: 28,\r\n    margin: 4\r\n  }\r\n}));\r\n\r\nconst debouncedSearch = debounce(async (setGlobalError, changePage) => {\r\n  try {\r\n    changePage(0);\r\n  } catch (e) {\r\n    setGlobalError('Error getting products');\r\n  }\r\n}, 1000);\r\n\r\nexport const SearchBoxComponent = params => {\r\n  const classes = styles();\r\n\r\n  const search = event => {\r\n    const searchText = !isUndefined(event.target.value) ? event.target.value : params.searchText;\r\n    params.setSearchText(trim(searchText));\r\n    debouncedSearch(params.setGlobalError, params.changePage);\r\n  };\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Paper className={classes.search}>\r\n        <InputBase\r\n          value={params.searchText}\r\n          className={classes.input}\r\n          placeholder={params.params.searchPlaceholderText}\r\n          inputProps={{ 'aria-label': 'search' }}\r\n          onChange={search}\r\n        />\r\n        <Divider className={classes.divider} orientation=\"vertical\" />\r\n        <Search className={classes.icon} />\r\n      </Paper>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst SearchBox = connect(\r\n  state => ({\r\n    params: state.params,\r\n    searchText: state.searchText,\r\n  }),\r\n  { changePage, setSearchText, setGlobalError }\r\n)(SearchBoxComponent);\r\n\r\nexport default SearchBox;\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { ButtonGroup, Button, makeStyles } from '@material-ui/core';\r\nimport { SkipNext, SkipPrevious, ArrowRight, ArrowLeft } from '@material-ui/icons';\r\n\r\nimport take from 'lodash/take';\r\nimport range from 'lodash/range';\r\nimport takeRight from 'lodash/takeRight';\r\n\r\nimport { changePage } from '../store/pages/pages.actions';\r\n\r\nconst styles = makeStyles(theme => ({\r\n  root: {\r\n    marginTop: theme.spacing(1)\r\n  }\r\n}));\r\n\r\nexport const PagerComponent = ({ changePage, page: { numPages, curPage } }) => {\r\n  const classes = styles();\r\n  const NUM_START_PAGES = 3;\r\n  const NUM_END_PAGES = 3;\r\n  const NUM_VISIBLE_PAGES = 6;\r\n  const allPages = range(numPages);\r\n  let pages = [];\r\n\r\n  if (curPage - NUM_START_PAGES < 0) {\r\n    pages = take(allPages, NUM_VISIBLE_PAGES);\r\n  } else if (curPage + NUM_END_PAGES > numPages) {\r\n    pages = takeRight(allPages, NUM_VISIBLE_PAGES);\r\n  } else {\r\n    const startPages = range(curPage - NUM_START_PAGES, curPage);\r\n    const endPages = range(curPage, curPage + NUM_END_PAGES);\r\n    pages = take([...startPages, ...endPages], NUM_VISIBLE_PAGES);\r\n  }\r\n\r\n  return (\r\n    <ButtonGroup color=\"primary\" className={classes.root}>\r\n      <Button aria-label=\"first\" onClick={() => changePage(0)} disabled={curPage === 0}>\r\n        <SkipPrevious fontSize=\"small\" />\r\n      </Button>\r\n      <Button aria-label=\"previous\" onClick={() => changePage(curPage - 1)} disabled={curPage === 0}>\r\n        <ArrowLeft fontSize=\"small\" />\r\n      </Button>\r\n      {pages.map(page => (\r\n        <Button variant={page === curPage ? 'contained' : null} key={page} onClick={() => changePage(page)}>\r\n          {page + 1}\r\n        </Button>\r\n      ))}\r\n      <Button aria-label=\"next\" onClick={() => changePage(curPage + 1)} disabled={curPage === numPages - 1}>\r\n        <ArrowRight fontSize=\"small\" />\r\n      </Button>\r\n      <Button aria-label=\"last\" onClick={() => changePage(numPages - 1)} disabled={curPage === numPages - 1}>\r\n        <SkipNext fontSize=\"small\" />\r\n      </Button>\r\n    </ButtonGroup>\r\n  );\r\n};\r\n\r\nconst Pager = connect(state => ({ page: state.page }), { changePage })(PagerComponent);\r\n\r\nexport default Pager;\r\n","import React from 'react';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\n\r\nconst FadeIn = ({ show = true, children, exitOptions = {}, className = '' }) => {\r\n  return (\r\n    <AnimatePresence>\r\n      {show && (\r\n        <motion.div \r\n          className={className}\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0, ...exitOptions }}>\r\n          {children}\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default FadeIn;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { Clear } from '@material-ui/icons';\r\nimport { Card, CardActionArea, CardMedia, CardHeader, IconButton, makeStyles } from '@material-ui/core';\r\nimport { toggleProduct } from '../store/selectedItems/selectedItems.actions';\r\n\r\nimport find from 'lodash/find';\r\nimport FadeIn from '../fade-in/FadeIn';\r\n\r\nimport './product.scss';\r\n\r\nconst styles = makeStyles(theme => ({\r\n\troot: {\r\n\t\tdisplay: 'flex',\r\n\t\tflex: '1 1 auto',\r\n\t\tflexDirection: 'column',\r\n\t\twidth: '100%',\r\n\t\ttransition: 'border-width 0.3s',\r\n\t\tborder: ({ isSelected }) => (isSelected ? `1px solid ${theme.palette.grey[500]}` : 'none'),\r\n\t\tmargin: ({ isSelected }) => (isSelected ? '6px' : theme.spacing(1)),\r\n\t\topacity: ({ readOnly }) => readOnly ? '0.6' : '',\r\n\t\tpointerEvents: ({ readOnly }) => readOnly ? 'none' : ''\r\n\t},\r\n\tcardWrapper: {\r\n\t\theight: '100%',\r\n\t\tdisplay: 'flex'\r\n\t},\r\n\tthumbnail: {\r\n\t\tpaddingBottom: '100%',\r\n\t\tmarginTop: 'auto',\r\n\t\tbackgroundColor: ({ hasImage }) => (hasImage ? 'transparent' : theme.palette.grey[100])\r\n\t},\r\n\tremoveBtn: {\r\n\t\tmarginLeft: theme.spacing(1)\r\n\t}\r\n}));\r\n\r\nexport const ProductComponent = params => {\r\n\tconst [visible, setVisible] = useState(false);\r\n\tconst isRemovable = params.variant === 'removable';\r\n\tconst isSelected = Boolean(find(params.selectedItems, { id: params.item.id }));\r\n\tconst { readOnly } = params.SDK.form;\r\n\tconst toggle = () => params.toggleProduct(params.item, isSelected);\r\n\r\n\tconst hideProduct = () => {\r\n\t\tsetVisible(true);\r\n\t\ttoggle();\r\n\t};\r\n\r\n\tuseEffect(() => setVisible(true), []);\r\n\r\n\tconst { name, image } = params.item;\r\n\r\n\tconst classes = styles({\r\n\t\tisSelected,\r\n\t\treadOnly,\r\n\t\thasImage: Boolean(image)\r\n\t});\r\n\r\n\tconst cardMedia = (\r\n\t\t<CardMedia\r\n\t\t\tclassName={classes.thumbnail}\r\n\t\t\timage={image || '/images/image-icon.svg'}\r\n\t\t\ttitle={name}>\r\n\t\t</CardMedia>\r\n\t);\r\n\r\n\tconst CardAction = () => (\r\n\t\t<IconButton \r\n\t\t\taria-label=\"Remove\"\r\n\t\t\tonClick={hideProduct}\r\n\t\t\tclassName={classes.removeBtn}>\r\n\t\t\t<Clear />\r\n\t\t</IconButton>\r\n\t);\r\n\r\n\tconst cardBody = (\r\n\t\tisRemovable ?\r\n\t\t\tcardMedia :\r\n\t\t\t<CardActionArea>{cardMedia}</CardActionArea>\r\n\t);\r\n\r\n\treturn (\r\n\t\t<FadeIn \r\n\t\t\tshow={visible}\r\n\t\t\tclassName={classes.cardWrapper}>\r\n\t\t\t<Card \r\n\t\t\t\tclassName={'product ' + classes.root}\r\n\t\t\t\traised={isSelected}\r\n\t\t\t\tonClick={isRemovable ? null : toggle}>\r\n\t\r\n\t\t\t\t<CardHeader\r\n\t\t\t\t\taction={isRemovable && <CardAction />}\r\n\t\t\t\t\ttitle={params.item.name}\r\n\t\t\t\t\tsubheader={'Product ID: ' + params.item.id}\r\n\t\t\t\t\ttitleTypographyProps={{ variant: 'subtitle1' }}\r\n\t\t\t\t\tsubheaderTypographyProps={{ variant: 'body2' }}/>\r\n\r\n\t\t\t\t{cardBody}\r\n\t\t\t</Card>\r\n\t\t</FadeIn>\r\n\t);\r\n};\r\n\r\nconst Product = connect(\r\n\t({ selectedItems, backend, SDK }) => ({ selectedItems, backend, SDK }),\r\n\t({ toggleProduct })\r\n)(ProductComponent);\r\n\r\nexport default Product;\r\n","import React, { useState, useEffect } from 'react';\r\n\r\nimport { connect } from 'react-redux';\r\nimport { changeCatalog, setCatalog } from '../store/catalog/catalog.actions';\r\nimport { Select, MenuItem, InputLabel, FormControl, makeStyles } from '@material-ui/core';\r\n\r\nconst styles = makeStyles(theme => ({\r\n  root: {\r\n    marginLeft: 'auto',\r\n    marginBottom: theme.spacing(1)\r\n  },\r\n  select: {\r\n    minWidth: 200\r\n  }\r\n}));\r\n\r\nexport const CatalogSelectorComponent = params => {\r\n  const [labelWidth, setLabelWidth] = useState(0);\r\n  const [selectedCatalog, setSelectedCatalog] = useState(params.selectedCatalog);\r\n\r\n  const classes = styles();\r\n  const inputLabel = React.useRef(null);\r\n\r\n  const selectCatalog = event => {\r\n    const newCatalog = event.target.value;\r\n    if (newCatalog === selectedCatalog) {\r\n      return;\r\n    }\r\n    setSelectedCatalog(newCatalog);\r\n    if (params.searchText.length) {\r\n      params.changeCatalog(newCatalog);\r\n    } else {\r\n      params.setCatalog(newCatalog);\r\n    }\r\n  };\r\n\r\n  useEffect(() => setLabelWidth(inputLabel.current.offsetWidth), []);\r\n\r\n  return (\r\n    <FormControl variant=\"outlined\" className={classes.root}>\r\n      <InputLabel id=\"catalog\" ref={inputLabel}>\r\n        Catalog\r\n      </InputLabel>\r\n      <Select\r\n        className={classes.select}\r\n        labelId=\"catalog\"\r\n        onChange={selectCatalog}\r\n        labelWidth={labelWidth}\r\n        value={selectedCatalog || ''}\r\n      >\r\n        {params.catalogs.map(({ id, name }) => (\r\n          <MenuItem key={id} value={id}>\r\n            {name}\r\n          </MenuItem>\r\n        ))}\r\n      </Select>\r\n    </FormControl>\r\n  );\r\n};\r\n\r\nconst CatalogSelector = connect(\r\n  state => ({\r\n    catalogs: state.params.catalogs,\r\n    searchText: state.searchText,\r\n    selectedCatalog: state.selectedCatalog,\r\n    backend: state.backend\r\n  }),\r\n  { changeCatalog, setCatalog }\r\n)(CatalogSelectorComponent);\r\n\r\nexport default CatalogSelector;\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { Typography } from '@material-ui/core';\r\n\r\nexport const PaginationSummaryComponent = params => {\r\n  const start = params.PAGE_SIZE * params.curPage;\r\n  const first = start + 1;\r\n  const last = Math.min(start + params.PAGE_SIZE, params.total);\r\n\r\n  return <Typography variant=\"body1\">{`Showing ${first} to ${last} of ${params.total}`}</Typography>;\r\n};\r\n\r\nconst PaginationSummary = connect(\r\n  state => ({\r\n    total: state.page.total,\r\n    curPage: state.page.curPage,\r\n    PAGE_SIZE: state.PAGE_SIZE\r\n  }),\r\n  {}\r\n)(PaginationSummaryComponent);\r\n\r\nexport default PaginationSummary;\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { CircularProgress, Grid, makeStyles } from '@material-ui/core';\r\n\r\nimport Pager from '../pager/Pager';\r\nimport FadeIn from '../fade-in/FadeIn';\r\nimport Product from '../product/Product';\r\nimport CatalogSelector from '../catalog-selector/CatalogSelector';\r\nimport PaginationSummary from '../pagination-summary/PaginationSummary';\r\n\r\nconst styles = makeStyles(theme => ({\r\n  root: {\r\n    width: '100%',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    flexDirection: 'column'\r\n  },\r\n  items: {\r\n    display: 'grid',\r\n    gridTemplateColumns: '100%',\r\n    justifyContent: 'space-between',\r\n    width: '100%',\r\n    '@media(min-width: 450px)': {\r\n      gridTemplateColumns: '50% 50%'\r\n    },\r\n    '@media(min-width: 800px)': {\r\n      gridTemplateColumns: '25% 25% 25% 25%'\r\n    },\r\n    '@media(min-width: 1024px)': {\r\n      gridTemplateColumns: '20% 20% 20% 20% 20%'\r\n    }\r\n  },\r\n  loader: {\r\n    margin: theme.spacing(2)\r\n  }\r\n}));\r\n\r\nexport const ProductsGridComponent = params => {\r\n  const classes = styles();\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Grid container alignItems=\"center\">\r\n        <Grid item xs={6}>\r\n          <FadeIn show={params.items.length && !params.loading}>\r\n            <PaginationSummary />\r\n          </FadeIn>\r\n        </Grid>\r\n        <Grid item container xs={6}>\r\n          {params.catalogs.length && params.initialised ? <CatalogSelector /> : ''}\r\n        </Grid>\r\n      </Grid>\r\n\r\n      <FadeIn \r\n        show={params.loading}\r\n        exitOptions={{ position: 'absolute' }}>\r\n        <CircularProgress className={classes.loader} />\r\n      </FadeIn>\r\n  \r\n      <div className={classes.items}>\r\n        {\r\n          !params.loading &&\r\n          params.items.map(item => <Product key={item.id} item={item} />)\r\n        }\r\n      </div>\r\n  \r\n      <FadeIn show={params.items.length && !params.loading}>\r\n        <Pager />\r\n      </FadeIn>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ProductsGrid = connect(\r\n  state => ({\r\n    items: state.items,\r\n    loading: state.isFetching,\r\n    initialised: state.initialised,\r\n    catalogs: state.params.catalogs,\r\n    backend: state.backend\r\n  }),\r\n  null\r\n)(ProductsGridComponent);\r\n\r\nexport default ProductsGrid;\r\n","import React from 'react';\r\nimport { FormHelperText } from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/styles';\r\n\r\nimport FadeIn from '../fade-in/FadeIn';\r\n\r\nconst styles = makeStyles(theme => ({\r\n  error: {\r\n    marginTop: theme.spacing(1)\r\n  }\r\n}));\r\n\r\nconst FormError = ({ show = true, children }) => {\r\n  const classes = styles();\r\n\r\n  return (\r\n    <FadeIn show={show}>\r\n      <FormHelperText error={true} className={classes.error}>\r\n        {children}\r\n      </FormHelperText>\r\n    </FadeIn>\r\n  );\r\n};\r\n\r\nexport default FormError;\r\n","import React, { useState } from 'react';\r\nimport get from 'lodash/get';\r\nimport { connect } from 'react-redux';\r\nimport { motion } from 'framer-motion';\r\nimport { makeStyles, CircularProgress, Paper, Typography, Box } from '@material-ui/core';\r\n\r\nimport { reorderItems } from '../store/selectedItems/selectedItems.actions';\r\n\r\nimport Sortable from 'react-sortablejs';\r\nimport FadeIn from '../fade-in/FadeIn';\r\nimport Product from '../product/Product';\r\nimport FormError from '../form-error/FormError';\r\n\r\nimport './selected-products.scss';\r\n\r\nconst styles = makeStyles(theme => ({\r\n  root: {\r\n    width: '100%',\r\n    minHeight: '200px',\r\n    margin: theme.spacing(2),\r\n    padding: theme.spacing(2),\r\n    backgroundColor: theme.palette.grey[100],\r\n    boxSizing: 'border-box',\r\n    overflow: 'hidden',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    position: 'relative'\r\n  },\r\n  dragItem: {\r\n    transition: 'flex 0.15s, opacity 0.15s'\r\n  },\r\n  title: {\r\n    fontWeight: 700\r\n  },\r\n  items: {\r\n    margin: 'auto',\r\n    width: '100%',\r\n    zIndex: 2,\r\n    display: 'grid',\r\n    gridTemplateColumns: '100%',\r\n    '@media(min-width: 450px)': {\r\n      gridTemplateColumns: '50% 50%'\r\n    },\r\n    '@media(min-width: 800px)': {\r\n      gridTemplateColumns: '25% 25% 25% 25%'\r\n    },\r\n    '@media(min-width: 1024px)': {\r\n      gridTemplateColumns: '20% 20% 20% 20% 20%'\r\n    }\r\n  },\r\n  errorWrapper: {\r\n    height: '20px',\r\n    marginTop: 'auto'\r\n  },\r\n  loader: {\r\n    margin: 'auto',\r\n    alignSelf: 'center'\r\n  },\r\n  placeholder: {\r\n    margin: '-12px 0 0 0',\r\n    position: 'absolute',\r\n    width: '100%',\r\n    textAlign: 'center',\r\n    top: '50%'\r\n  }\r\n}));\r\n\r\nexport const SelectedProductsComponent = params => {\r\n  const [isDragging, setDragging] = useState(false);\r\n  const { minItems, maxItems } = get(params.SDK, 'field.schema', {});\r\n  const { readOnly } = get(params.SDK, 'form', {});\r\n  const classes = styles({ readOnly });\r\n  const showMinItemError = params.touched && minItems && params.selectedItems.length < minItems;\r\n  const showMaxItemError = params.touched && maxItems && params.selectedItems.length > maxItems;\r\n\r\n  const items = params.selectedItems.length ? (\r\n    <ProductList selectedItems={params.selectedItems} classes={classes} isDragging={isDragging}/>\r\n  ) : (\r\n    <NoItems classes={classes} noItemsText={params.params.noItemsText} />\r\n  );\r\n\r\n  return (\r\n    <Paper className={'selected-products ' + classes.root}>\r\n      <Typography variant=\"subtitle1\" component=\"h2\" className={classes.title}>\r\n        {get(params.SDK, 'field.schema.title', 'Selected products')}\r\n      </Typography>\r\n\r\n      <Loading show={!params.initialised} className={classes.loader} />\r\n\r\n      <FadeIn show={params.initialised}>\r\n        {readOnly && <div className={classes.items}>{items}</div>}\r\n        {!readOnly && (\r\n          <Sortable\r\n            onChange={(_, sortable, indexes) => params.reorderItems(indexes)}\r\n            className={classes.items}\r\n            options={{\r\n              animation: 150,\r\n              ghostClass: 'product-placeholder',\r\n              onStart: () => setDragging(true),\r\n              onEnd: () => setDragging(false)\r\n            }}\r\n          >\r\n            {items}\r\n          </Sortable>\r\n        )}\r\n        \r\n      </FadeIn>\r\n\r\n      <div className={classes.errorWrapper}>\r\n        <FormError show={Boolean(showMinItemError)}>You must select a minimum of {minItems} items</FormError>\r\n        <FormError show={Boolean(showMaxItemError)}>You must select a maximum of {maxItems} items</FormError>\r\n      </div>\r\n    </Paper>\r\n  );\r\n};\r\n\r\nconst ProductList = ({ selectedItems, classes, isDragging }) => {\r\n  return selectedItems.map(item => (\r\n    <motion.div positionTransition={isDragging ? null : {type: 'tween'}} key={item.id}>\r\n      <Product className={classes.dragItem} item={item} variant=\"removable\" />\r\n    </motion.div>\r\n  ));\r\n};\r\n\r\nconst Loading = ({ show, className }) => (\r\n  <FadeIn\r\n    show={show}\r\n    className={className}\r\n    exitOptions={{position: 'absolute', zIndex: 3, top: '50%', marginTop: '-20px'}}\r\n  >\r\n    <CircularProgress />\r\n  </FadeIn>\r\n);\r\n\r\nconst NoItems = ({ classes, noItemsText }) => (\r\n  <Typography component=\"div\" variant=\"body1\" className={classes.placeholder}>\r\n    <Box fontWeight=\"fontWeightLight\">{noItemsText}</Box>\r\n  </Typography>\r\n);\r\n\r\nconst SelectedProducts = connect(\r\n  state => ({\r\n    selectedItems: state.selectedItems,\r\n    SDK: state.SDK,\r\n    params: state.params,\r\n    touched: state.touched,\r\n    backend: state.backend,\r\n    initialised: state.initialised\r\n  }),\r\n  { reorderItems }\r\n)(SelectedProductsComponent);\r\n\r\nexport default SelectedProducts;\r\n","import React from 'react';\r\n\r\nimport { theme } from './theme';\r\nimport { connect } from 'react-redux';\r\nimport { Warning } from '@material-ui/icons';\r\nimport { setGlobalError } from './store/global-error/global-error.actions';\r\nimport { makeStyles, Container, Snackbar } from '@material-ui/core';\r\n\r\nimport SearchBox from './search-box/SearchBox';\r\nimport ProductsGrid from './products-grid/ProductsGrid';\r\nimport SelectedProducts from './selected-products/SelectedProducts';\r\n\r\nconst styles = makeStyles(() => ({\r\n  root: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center'\r\n  },\r\n  message: {\r\n    display: 'flex',\r\n    alignItems: 'center'\r\n  },\r\n  icon: {\r\n    marginRight: theme.spacing(1)\r\n  }\r\n}));\r\n\r\n\r\nconst AppComponent = params => {\r\n  const classes = styles();\r\n\r\n  const message = (\r\n    <span className={classes.message}>\r\n      <Warning className={classes.icon} />\r\n      {params.globalError}\r\n    </span>\r\n  );\r\n\r\n  return (\r\n    <Container className={classes.root}>\r\n      <Snackbar\r\n        anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\r\n        autoHideDuration={3000}\r\n        onClose={() => params.setGlobalError(null)}\r\n        open={Boolean(params.globalError)}\r\n        message={message}\r\n      />\r\n      <SelectedProducts />\r\n      <SearchBox />\r\n      <ProductsGrid />\r\n    </Container>\r\n  );\r\n};\r\n\r\nconst App = connect(\r\n  state => ({ globalError: state.globalError }),\r\n  { setGlobalError }\r\n)(AppComponent);\r\n\r\nexport default App;\r\n","import 'react-app-polyfill/stable';\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { store } from './store/store';\r\nimport { theme } from './theme';\r\nimport { Provider } from 'react-redux';\r\nimport { fetchSDK } from './store/sdk/sdk.actions';\r\nimport { MuiThemeProvider } from '@material-ui/core';\r\n\r\nimport App from './App';\r\n\r\nimport './index.scss';\r\n\r\nstore.dispatch(fetchSDK());\r\n\r\nconst Render = () => (\r\n  <Provider store={store}>\r\n    <MuiThemeProvider theme={theme}>\r\n      <App />\r\n    </MuiThemeProvider>\r\n  </Provider>\r\n);\r\n\r\nReactDOM.render(<Render />, document.getElementById('root'));\r\n"],"sourceRoot":""}