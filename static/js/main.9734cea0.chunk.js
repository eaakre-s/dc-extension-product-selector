(this["webpackJsonpdc-extension-product-selector"]=this["webpackJsonpdc-extension-product-selector"]||[]).push([[0],{303:function(e,t,n){e.exports=n(623)},618:function(e,t,n){},621:function(e,t,n){},622:function(e,t,n){},623:function(e,t,n){"use strict";n.r(t);n(304);var r=n(0),a=n.n(r),c=n(18),i=n.n(c),s=n(275),o=n(85),u=n(5),l=n.n(u),p=n(27),d=n(10),h=n(276),m=function(e){return{type:"SET_PARAMS",value:e}},f=n(45),g=n(53),v=n(119),E=n.n(v),b=n(26),y=n(292),x=n(277),k=n(293),T=function(e){Object(x.a)(n,e);var t=Object(y.a)(n);function n(e,r){var a;return Object(f.a)(this,n),(a=t.call(this,e)).code="UNDEFINED",r&&(a.code=r),a}return n}(Object(k.a)(Error));T.codes={INVALID_FIELD:"INVALID_PROPERTY",INVALID_VALUE:"INVALID_VALUE",GET_ITEMS:"GET_ITEMS",GET_SELECTED_ITEMS:"GET_SELECTED_ITEMS",GET_SDK:"GET_SDK"};var w=function(){function e(t){Object(f.a)(this,e),this.settings=t}return Object(g.a)(e,[{key:"getHeaders",value:function(e){var t=e.params,n=t.authSecret;return{headers:{"Content-Type":"application/json","x-auth-id":t.authClientId,"x-auth-secret":n,endpoint:t.sfccUrl}}}},{key:"getItems",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s,o,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params,a=r.siteId,c=r.proxyUrl,e.prev=1,i=E.a.stringify({site_id:a,ids:n},{arrayFormat:"brackets"}),(s=Object(p.a)({method:"GET"},this.getHeaders(t))).method="GET",e.next=7,fetch(Object(b.trimEnd)(c,"/")+"/products?"+i,s);case 7:return o=e.sent,e.next=10,o.json();case 10:return u=e.sent,d=u.items,e.abrupt("return",d);case 15:throw e.prev=15,e.t0=e.catch(1),console.error(e.t0),new T("Could not get items",T.codes.GET_SELECTED_ITEMS);case 19:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,o,u,d,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.searchText,r=t.page,a=t.selectedCatalog,c=t.params,i=c.siteId,s=c.proxyUrl,o={items:[],page:{numPages:0,curPage:0,total:0}},e.prev=2,u={site_id:i,search_text:n,page:r.curPage},null!==a&&(u.catalog_id=a),d=Object(p.a)({method:"POST",body:JSON.stringify(u)},this.getHeaders(t)),e.next=8,fetch(Object(b.trimEnd)(s,"/")+"/product-search",d);case 8:return h=e.sent,e.abrupt("return",h.json()||o);case 12:throw e.prev=12,e.t0=e.catch(2),console.error(e.t0),new T("Could not search",T.codes.GET_ITEMS);case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportItem",value:function(e){return e.id}}]),e}(),S=function(){function e(t){Object(f.a)(this,e),this.settings=t,this.tokens={}}return Object(g.a)(e,[{key:"tokenExpired",value:function(e){return(new Date).getTime()+3e5>e}},{key:"getAuth",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,o,u,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params,r=n.authSecret,a=n.authClientId,c=n.authUrl,i=void 0===c?"https://account.demandware.com/dw/oauth2/access_token":c,s=btoa(a+":"+r),!(o=this.tokens[s])){e.next=9;break}if(!this.tokenExpired(o.expires)){e.next=8;break}delete this.tokens[s],e.next=9;break;case 8:return e.abrupt("return",o.token);case 9:return u={method:"POST",headers:{Authorization:"Basic "+s,"Content-Type":"application/x-www-form-urlencoded"},body:"grant_type=client_credentials"},e.next=12,fetch(i,u);case 12:if((p=e.sent).ok){e.next=20;break}return e.t0=Error,e.next=17,p.text();case 17:throw e.t1=e.sent,e.t2=p.statusText,new e.t0("Error fetching token",e.t1,e.t2);case 20:return e.next=22,p.json();case 22:return d=e.sent,1e3,this.tokens[s]={token:d.access_token,expires:(new Date).getTime()+1e3*d.expires_in},e.abrupt("return",d.access_token);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"commonSearch",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s,o,u,p,d,h,m,f,g,v,E,y,x,k;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.PAGE_SIZE,a=t.page,c=t.params,i=c.siteId,s=c.sfccUrl,o=c.sfccVersion,u=void 0===o?"v21_10":o,e.next=3,this.getAuth(t);case 3:return p=e.sent,d={items:[],page:{numPages:0,curPage:0,total:0}},h=s+("/s/-/dw/data/"+u)+"/product_search?site_id="+i,m={method:"POST",headers:{Authorization:"Bearer "+p,"Content-Type":"application/json"},body:JSON.stringify({query:n,start:a.curPage*r,count:r,expand:["images"],select:"(**)"})},e.next=10,fetch(h,m);case 10:return f=e.sent,e.next=13,f.json();case 13:if(g=e.sent){e.next=16;break}return e.abrupt("return",d);case 16:return v=g.hits,E=g.total,y=[],x=Math.ceil(E/r),k={numPages:x,curPage:a.curPage,total:E},v&&(y=v.map((function(e){return{id:e.id,name:Object(b.get)(e,"name.default",null),image:Object(b.get)(e,"image.abs_url",null)}}))),e.abrupt("return",{items:y,page:k});case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={term_query:{fields:["id"],operator:"one_of",values:n}},e.prev=1,e.next=4,this.commonSearch(t,r);case 4:return a=e.sent,c=a.items,e.abrupt("return",c);case 9:throw e.prev=9,e.t0=e.catch(1),console.error(e.t0),new T("Could not search",T.codes.GET_SELECTED_ITEMS);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.searchText,r=t.selectedCatalog,a={bool_query:{must:[{text_query:{fields:["id","name"],search_phrase:n}},{term_query:{fields:["catalog_id"],operator:"is",values:r?[r]:[]}}]}},e.prev=2,e.next=5,this.commonSearch(t,a);case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),console.error(e.t0),new T("Could not search",T.codes.GET_ITEMS);case 12:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportItem",value:function(e){return e.id}}]),e}(),O=n(278),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.hybrisUrl,r=t.hybrisEndpoint;Object(f.a)(this,e),this.hybrisUrl=n,r||(r="/rest/v2"),this.hybrisEndpoint=r,this.productService=new O.ProductService(n,r,null)}return Object(g.a)(e,[{key:"getItems",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params,a=r.currency,c=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.catalog,e.next=3,i.productService.getByCode(r,n,a);case 3:return c=e.sent,e.abrupt("return",i.itemModel(c,r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=3,e.abrupt("return",Promise.all(n.map(c)));case 7:throw e.prev=7,e.t0=e.catch(3),console.error(e.t0),new T("Could not get items",T.codes.GET_SELECTED_ITEMS);case 11:case"end":return e.stop()}}),e,null,[[3,7]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._get(t);case 3:return n=e.sent,r=n.items,a=n.page,e.abrupt("return",{items:r,page:a});case 9:throw e.prev=9,e.t0=e.catch(0),console.error(e.t0),new T("Could not get items",T.codes.GET_ITEMS);case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,o,u,p,d,h,m,f,g=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.selectedCatalog,r=t.searchText,a=t.page,c=t.params,i=c.currency,e.next=4,this.productService.search(n,r,i,a.curPage);case 4:return s=e.sent,o=s.products,u=s.pagination,p=u.totalResults,d=u.currentPage,h=u.totalPages,m={total:p,curPage:d,numPages:h},f=o.map((function(e){return g.itemModel(e,n)})),e.abrupt("return",{items:f,page:m});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getImage",value:function(e){var t=function(e){return e.images.find((function(e){return"product"===e.format}))};return e.images&&e.images.length&&t(e)?this.hybrisUrl+t(e).url:e.defaultImageUrl}},{key:"stripHtml",value:function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}},{key:"itemModel",value:function(e,t){var n=e.code,r=e.name,a=e.images,c=e.defaultImageUrl;return{id:n,name:this.stripHtml(r),image:this.getImage({images:a,defaultImageUrl:c}),catalog:t}}},{key:"exportItem",value:function(e){return{id:e.id,catalog:e.catalog}}}]),e}(),I=n(152),j=n(279),C=n.n(j),D=function(){function e(t){var n=t.host,r=t.projectKey,a=t.clientId,c=t.clientSecret,i=t.apiUrl,s=t.scope,o=void 0===s?"view_published_products":s,u=t.locale;Object(f.a)(this,e),this.sdkAuth=new C.a({host:n,projectKey:r,disableRefreshToken:!1,credentials:{clientId:a,clientSecret:c},scopes:[o+":"+r]}),this.apiUrl=i,this.locale=u}return Object(g.a)(e,[{key:"getHeaders",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdkAuth.clientCredentialsFlow();case 2:return this.token=e.sent,t=this.token,n=t.token_type,r=t.access_token,e.abrupt("return",{headers:{Authorization:"".concat(n," ").concat(r)}});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,o,u,d,h,m=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>1&&void 0!==m[1]?m[1]:[],r=t.PAGE_SIZE,a=t.params.projectKey,e.prev=2,n.length){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.getHeaders();case 7:return c=e.sent,i='"'+n.join('","')+'"',s=Object(p.a)({method:"GET"},c),o=E.a.stringify({staged:!1,limit:r,where:"key in (".concat(i,")")}),e.next=13,fetch("".concat(this.apiUrl,"/").concat(a,"/product-projections?").concat(o),s);case 13:return u=e.sent,e.next=16,u.json();case 16:return d=e.sent,h=d.results,e.abrupt("return",this.parseResults(h));case 21:throw e.prev=21,e.t0=e.catch(2),console.error(e.t0),new T("Could not get items",T.codes.GET_SELECTED_ITEMS);case 25:case"end":return e.stop()}}),e,this,[[2,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getImage",value:function(e){var t=e.attributes,n=void 0===t?[]:t,r=e.images,a=void 0===r?[]:r,c=n.find((function(e){var t=e.name;return"largeImageUrl"===(void 0===t?"":t)}));return c&&c.value?c.value:a.length?a[0].url:""}},{key:"parseResults",value:function(e){var t=this;return e.map((function(e){return{id:e.id,key:e.key,name:e.name[t.locale],image:t.getImage(e.masterVariant)}}))}},{key:"search",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,o,u,d,h,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.searchText,r=t.page,a=t.PAGE_SIZE,c=t.params.projectKey,e.prev=1,e.next=4,this.getHeaders();case 4:return i=e.sent,s=Object(p.a)({method:"GET"},i),o=E.a.stringify(Object(I.a)({staged:!1,offset:r.curPage*a,limit:a},"text.".concat(this.locale),n)),e.next=9,fetch("".concat(this.apiUrl,"/").concat(c,"/product-projections/search?").concat(o),s);case 9:return u=e.sent,e.next=12,u.json();case 12:return d=e.sent,h=d.results,m=d.total,e.abrupt("return",{items:this.parseResults(h),page:{numPages:Math.ceil(m/a),curPage:r.curPage,total:m}});case 18:throw e.prev=18,e.t0=e.catch(1),console.error(e.t0),new T("Could not search",T.codes.GET_ITEMS);case 22:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportItem",value:function(e){return e.key}}]),e}(),P=function(){function e(t,n,r){Object(f.a)(this,e),this._clientId=t,this._sharedSecret=n,this._authHost=r;var a=void 0;try{var c=window.localStorage.get("kibo-at");c&&(a=JSON.parse(c))}catch(i){}this.authData=a}return Object(g.a)(e,[{key:"_buildFetchOptions",value:function(e){return{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}}},{key:"_calculateTicketExpiration",value:function(e){var t=1e3*e.expires_in;return e.expires_at=Date.now()+t,e}},{key:"_getAuthTicket",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.authData);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setAuthTicket",value:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{window.localStorage.set("kibo-at",JSON.stringify(t))}catch(n){}this.authData=Object(p.a)({},t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authenticate",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._buildFetchOptions({client_id:this._clientId,client_secret:this._sharedSecret,grant_type:"client_credentials"}),e.next=3,fetch("https://".concat(this._authHost,"/api/platform/applications/authtickets/oauth"),t);case 3:return e.next=5,e.sent.json();case 5:return n=e.sent,this._calculateTicketExpiration(n),e.next=9,this._setAuthTicket(n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshTicket",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._buildFetchOptions({client_id:this._clientId,client_secret:this._sharedSecret,grant_type:"client_credentials",refresh_token:t&&t.refresh_token}),e.next=3,fetch("https://".concat(this._authHost,"/api/platform/applications/authtickets/oauth"),n);case 3:return e.next=5,e.sent.json();case 5:return r=e.sent,this._calculateTicketExpiration(r),e.next=9,this._setAuthTicket(r);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getAuthTicket();case 2:if(t=e.sent){e.next=9;break}return e.next=6,this.authenticate();case 6:t=e.sent,e.next=13;break;case 9:if(!(t.expires_at<Date.now())){e.next=13;break}return e.next=12,this.refreshTicket(t);case 12:t=e.sent;case 13:return e.abrupt("return",t.access_token);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),A=function(){function e(t){var n=t.apiHost,r=t.authHost,a=t.clientId,c=t.sharedSecret;Object(f.a)(this,e),this.graphQLUrl="https://".concat(n,"/graphql"),this.authHelper=new P(a,c,r)}return Object(g.a)(e,[{key:"getAccessToken",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authHelper.getAccessToken();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeaders",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccessToken();case 2:return t=e.sent,e.abrupt("return",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"performSearch",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,o,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query,r=t.filter,a=t.pageSize,c=t.startIndex,e.next=3,this.getHeaders();case 3:return i=e.sent,s={query:"\n  query Search($query: String, $filter: String, $pageSize: Int, $startIndex: Int) {\n    productSearch(query: $query, filter: $filter, pageSize: $pageSize, startIndex: $startIndex) {\n      items {\n        productCode\n        content {\n          productName\n          productImages {\n            imageUrl\n          }\n        }\n      }\n      totalCount\n      pageSize\n      startIndex\n    }\n  }\n",variables:{query:n,filter:r,pageSize:a,startIndex:c}},o=Object(p.a)({method:"POST"},i,{body:JSON.stringify(s)}),e.next=8,fetch(this.graphQLUrl,o);case 8:return u=e.sent,e.next=11,u.json();case 11:return d=e.sent,e.abrupt("return",d.data.productSearch);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:[],r=t.PAGE_SIZE,a=n.map((function(e){return"productCode eq ".concat(e)})).join(" or "),e.prev=3,e.next=6,this.performSearch({filter:a,pageSize:r});case 6:return c=e.sent,e.abrupt("return",this.normalizeItems(c.items));case 10:throw e.prev=10,e.t0=e.catch(3),console.error(e.t0),new T("Could not get items",T.codes.GET_SELECTED_ITEMS);case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.searchText,r=t.page,a=t.PAGE_SIZE,e.prev=1,c=(r.curPage||0)*a,e.next=5,this.performSearch({query:n,pageSize:a,startIndex:c});case 5:if((i=e.sent).totalCount){e.next=8;break}return e.abrupt("return",{items:[],page:{numPages:0,curPage:0,total:0}});case 8:return e.abrupt("return",{items:this.normalizeItems(i.items),page:{numPages:Math.ceil(i.totalCount/a),curPage:r.curPage,total:i.totalCount}});case 11:throw e.prev=11,e.t0=e.catch(1),console.error(e.t0),new T("Could not search",T.codes.GET_ITEMS);case 15:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"exportItem",value:function(e){return e.id}},{key:"getImageUrl",value:function(e){var t=e.content,n=(void 0===t?{}:t).productImages,r=(void 0===n?[]:n)[0];return r?r.imageUrl:""}},{key:"normalizeItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map((function(t){return{id:t.productCode,name:t.content.productName,image:e.getImageUrl(t)}}))}}]),e}(),N="sfcc",G="sfcc-cors",L="hybris",M="commercetools",U="kibocommerce",R=function(){return function(e,t){var n=function(e){switch(e.backend){case L:return new _(e);case M:return new D(e);case U:return new A(e);case G:return new S(e);case N:default:return new w(e)}}(t().params);e(H(n))}},H=function(e){return{type:"SET_BACKEND",value:e}},z=n(280),K=n.n(z),B=n(281),V=n.n(B),q=n(282),F=n.n(q),W=n(283),Z=n.n(W),J=n(44),$=n.n(J),X=function(e){return{type:"SET_PAGE",value:e}},Y=function(e){return function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=r(),c=a.page,n(X(Object(p.a)({},c,{curPage:e}))),n(ne());case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Q=function(e){return{type:"SET_FETCHING",value:e}},ee=function(e){return{type:"SET_GLOBAL_ERROR",value:e}},te=function(e){return function(){var t=Object(d.a)(l.a.mark((function t(n,r){var a,c,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r(),c=a.SDK,i=a.backend,t.prev=1,t.next=4,c.field.setValue(Object(b.map)(e,(function(e){return i.exportItem(e)})));case 4:t.next=10;break;case 6:t.prev=6,t.t0=t.catch(1),Object(b.get)(t.t0,"[0].data.keyword")||n(ee("Could not set value"));case 10:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(e,n){return t.apply(this,arguments)}}()},ne=function(){return function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(),!Object(b.isEmpty)(Object(b.trim)(r.searchText))){e.next=6;break}return t(X({numPages:0,curPage:0,total:0})),t(re([])),e.abrupt("return");case 6:return t(Q(!0)),a=[],e.prev=8,e.next=11,r.backend.search(r);case 11:c=e.sent,i=c.items,s=c.page,a=i,t(X(s)),t(re(a)),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(8),t(ee("Could not get items")),console.error(e.t0);case 23:t(Q(!1));case 24:case"end":return e.stop()}}),e,null,[[8,19]])})));return function(t,n){return e.apply(this,arguments)}}()},re=function(e){return{type:"SET_ITEMS",value:e}},ae=function(e){return{type:"SET_INITIALISED",value:e}},ce=function(e){return{type:"ADD_SELECTED_ITEM",value:e}},ie=function(e){return{type:"REMOVE_SELECTED_ITEM",value:e}},se=function(e){return{type:"SET_CATALOG",value:e}},oe=function(e){return{type:"SET_SDK",value:e}};var ue={numPages:0,curPage:0,total:0};var le={proxyUrl:"",sfccUrl:"",authSecret:"",authClientId:"",siteId:"",currency:"USD",catalogs:[],backend:"SFCC",noItemsText:"No items selected.",searchPlaceholderText:"Search"};var pe=n(87);var de=Object(o.c)({SDK:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SDK":return t.value;default:return e}},page:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PAGE":return Object(p.a)({},e,{},t.value);default:return e}},items:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ITEMS":return t.value;default:return e}},params:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.value;switch(n){case"SET_PARAMS":var a=r||{},c=a.installation,i=a.instance,s=Object(p.a)({},c,{},i);return Object(p.a)({},e,{},s,{backend:Object(b.toLower)(s.backend)});default:return e}},backend:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_BACKEND":return t.value;default:return e}},touched:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TOUCHED":return t.value;default:return e}},isFetching:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_FETCHING":return t.value;default:return e}},searchText:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SEARCH_TEXT":return t.value;default:return e}},initialised:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INITIALISED":return t.value;default:return e}},selectedCatalog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CATALOG":return t.value;default:return e}},selectedItems:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SELECTED_ITEMS":return t.value;case"REMOVE_SELECTED_ITEM":return Object(b.reject)(e,{id:t.value.id});case"ADD_SELECTED_ITEM":return[].concat(Object(pe.a)(e),[t.value]);case"REORDER_SELECTED_ITEM":var n=t.value,r=n.oldIndex,a=n.newIndex,c=e[r],i=Object(b.reject)(e,{id:c.id}),s=[].concat(Object(pe.a)(Object(b.slice)(i,0,a)),[c],Object(pe.a)(Object(b.slice)(i,a)));return s;default:return e}},globalError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GLOBAL_ERROR":return t.value;default:return e}},PAGE_SIZE:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return e}}),he=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.d,me=Object(o.e)(de,he(Object(o.a)(s.a))),fe=n(291),ge=Object(fe.a)({palette:{primary:{main:"#039be5"},secondary:{main:"#1ab0f9"},error:{main:"#ff3366"}}}),ve=n(28),Ee=n(675),be=n(673),ye=n(653),xe=n(674),ke=n(679),Te=n(626),we=n(680),Se=n(656),Oe=n(657),_e=Object(ye.a)((function(e){return{root:{width:"100%",marginBottom:e.spacing(2)},search:{padding:"2px 4px",display:"flex",alignItems:"center"},input:{marginLeft:e.spacing(1),flex:1},icon:{padding:10,fill:"rgba(0, 0, 0, 0.54)"},divider:{height:28,margin:4}}})),Ie=Object(b.debounce)(function(){var e=Object(d.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n(0)}catch(r){t("Error getting products")}case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),1e3),je=Object(ve.b)((function(e){return{params:e.params,searchText:e.searchText}}),{changePage:Y,setSearchText:function(e){return{type:"SET_SEARCH_TEXT",value:e}},setGlobalError:ee})((function(e){var t=_e();return a.a.createElement("div",{className:t.root},a.a.createElement(Te.a,{className:t.search},a.a.createElement(we.a,{value:e.searchText,className:t.input,placeholder:e.params.searchPlaceholderText,inputProps:{"aria-label":"search"},onChange:function(t){var n=Object(b.isUndefined)(t.target.value)?e.searchText:t.target.value;e.setSearchText(Object(b.trim)(n)),Ie(e.setGlobalError,e.changePage)}}),a.a.createElement(Se.a,{className:t.divider,orientation:"vertical"}),a.a.createElement(Oe.a,{className:t.icon})))})),Ce=n(670),De=n(671),Pe=n(658),Ae=n(627),Ne=n(659),Ge=n(660),Le=n(661),Me=n(662),Ue=n(202),Re=n.n(Ue),He=n(162),ze=n.n(He),Ke=n(288),Be=n.n(Ke),Ve=Object(ye.a)((function(e){return{root:{marginTop:e.spacing(1)}}})),qe=Object(ve.b)((function(e){return{page:e.page}}),{changePage:Y})((function(e){var t=e.changePage,n=e.page,r=n.numPages,c=n.curPage,i=Ve(),s=ze()(r),o=[];if(c-3<0)o=Re()(s,6);else if(c+3>r)o=Be()(s,6);else{var u=ze()(c-3,c),l=ze()(c,c+3);o=Re()([].concat(Object(pe.a)(u),Object(pe.a)(l)),6)}return a.a.createElement(Pe.a,{color:"primary",className:i.root},a.a.createElement(Ae.a,{"aria-label":"first",onClick:function(){return t(0)},disabled:0===c},a.a.createElement(Ne.a,{fontSize:"small"})),a.a.createElement(Ae.a,{"aria-label":"previous",onClick:function(){return t(c-1)},disabled:0===c},a.a.createElement(Ge.a,{fontSize:"small"})),o.map((function(e){return a.a.createElement(Ae.a,{variant:e===c?"contained":null,key:e,onClick:function(){return t(e)}},e+1)})),a.a.createElement(Ae.a,{"aria-label":"next",onClick:function(){return t(c+1)},disabled:c===r-1},a.a.createElement(Le.a,{fontSize:"small"})),a.a.createElement(Ae.a,{"aria-label":"last",onClick:function(){return t(r-1)},disabled:c===r-1},a.a.createElement(Me.a,{fontSize:"small"})))})),Fe=n(125),We=function(e){var t=e.show,n=void 0===t||t,r=e.children,c=e.exitOptions,i=void 0===c?{}:c,s=e.className,o=void 0===s?"":s;return a.a.createElement(Fe.a,null,n&&a.a.createElement(Fe.b.div,{className:o,initial:{opacity:0},animate:{opacity:1},exit:Object(p.a)({opacity:0},i)},r))},Ze=n(84),Je=n(665),$e=n(663),Xe=n(664),Ye=n(666),Qe=n(667),et=n(668),tt=n(289),nt=n.n(tt),rt=(n(618),Object(ye.a)((function(e){return{root:{display:"flex",flex:"1 1 auto",flexDirection:"column",width:"100%",transition:"border-width 0.3s",border:function(t){return t.isSelected?"1px solid ".concat(e.palette.grey[500]):"none"},margin:function(t){return t.isSelected?"6px":e.spacing(1)},opacity:function(e){return e.readOnly?"0.6":""},pointerEvents:function(e){return e.readOnly?"none":""}},cardWrapper:{height:"100%",display:"flex"},thumbnail:{paddingBottom:"100%",marginTop:"auto",backgroundColor:function(t){return t.hasImage?"transparent":e.palette.grey[100]}},removeBtn:{marginLeft:e.spacing(1)}}}))),at=Object(ve.b)((function(e){return{selectedItems:e.selectedItems,backend:e.backend,SDK:e.SDK}}),{toggleProduct:function(e,t){return function(){var n=Object(d.a)(l.a.mark((function n(r,a){var c,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r(t?ie(e):ce(e)),r({type:"SET_TOUCHED",value:!0}),c=a(),i=c.selectedItems,r(te(i));case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}})((function(e){var t=Object(r.useState)(!1),n=Object(Ze.a)(t,2),c=n[0],i=n[1],s="removable"===e.variant,o=Boolean(nt()(e.selectedItems,{id:e.item.id})),u=e.SDK.form.readOnly,l=function(){return e.toggleProduct(e.item,o)},p=function(){i(!0),l()};Object(r.useEffect)((function(){return i(!0)}),[]);var d=e.item,h=d.name,m=d.image,f=rt({isSelected:o,readOnly:u,hasImage:Boolean(m)}),g=a.a.createElement($e.a,{className:f.thumbnail,image:m||"/images/image-icon.svg",title:h}),v=function(){return a.a.createElement(Xe.a,{"aria-label":"Remove",onClick:p,className:f.removeBtn},a.a.createElement(Je.a,null))},E=s?g:a.a.createElement(Ye.a,null,g);return a.a.createElement(We,{show:c,className:f.cardWrapper},a.a.createElement(Qe.a,{className:"product "+f.root,raised:o,onClick:s?null:l},a.a.createElement(et.a,{action:s&&a.a.createElement(v,null),title:e.item.name,subheader:"Product Key: "+e.item.key,titleTypographyProps:{variant:"subtitle1"},subheaderTypographyProps:{variant:"body2"}}),E))})),ct=n(669),it=n(681),st=n(676),ot=n(682),ut=Object(ye.a)((function(e){return{root:{marginLeft:"auto",marginBottom:e.spacing(1)},select:{minWidth:200}}})),lt=Object(ve.b)((function(e){return{catalogs:e.params.catalogs,searchText:e.searchText,selectedCatalog:e.selectedCatalog,backend:e.backend}}),{changeCatalog:function(e){return function(){var t=Object(d.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(se(e)),n(Y(0));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setCatalog:se})((function(e){var t=Object(r.useState)(0),n=Object(Ze.a)(t,2),c=n[0],i=n[1],s=Object(r.useState)(e.selectedCatalog),o=Object(Ze.a)(s,2),u=o[0],l=o[1],p=ut(),d=a.a.useRef(null);return Object(r.useEffect)((function(){return i(d.current.offsetWidth)}),[]),a.a.createElement(ct.a,{variant:"outlined",className:p.root},a.a.createElement(it.a,{id:"catalog",ref:d},"Catalog"),a.a.createElement(st.a,{className:p.select,labelId:"catalog",onChange:function(t){var n=t.target.value;n!==u&&(l(n),e.searchText.length?e.changeCatalog(n):e.setCatalog(n))},labelWidth:c,value:u||""},e.catalogs.map((function(e){var t=e.id,n=e.name;return a.a.createElement(ot.a,{key:t,value:t},n)}))))})),pt=n(163),dt=Object(ve.b)((function(e){return{total:e.page.total,curPage:e.page.curPage,PAGE_SIZE:e.PAGE_SIZE}}),{})((function(e){var t=e.PAGE_SIZE*e.curPage,n=t+1,r=Math.min(t+e.PAGE_SIZE,e.total);return a.a.createElement(pt.a,{variant:"body1"},"Showing ".concat(n," to ").concat(r," of ").concat(e.total))})),ht=Object(ye.a)((function(e){return{root:{width:"100%",display:"flex",alignItems:"center",flexDirection:"column"},items:{display:"grid",gridTemplateColumns:"100%",justifyContent:"space-between",width:"100%","@media(min-width: 450px)":{gridTemplateColumns:"50% 50%"},"@media(min-width: 800px)":{gridTemplateColumns:"25% 25% 25% 25%"},"@media(min-width: 1024px)":{gridTemplateColumns:"20% 20% 20% 20% 20%"}},loader:{margin:e.spacing(2)}}})),mt=Object(ve.b)((function(e){return{items:e.items,loading:e.isFetching,initialised:e.initialised,catalogs:e.params.catalogs,backend:e.backend}}),null)((function(e){var t=ht();return a.a.createElement("div",{className:t.root},a.a.createElement(Ce.a,{container:!0,alignItems:"center"},a.a.createElement(Ce.a,{item:!0,xs:6},a.a.createElement(We,{show:e.items.length&&!e.loading},a.a.createElement(dt,null))),a.a.createElement(Ce.a,{item:!0,container:!0,xs:6},e.catalogs.length&&e.initialised?a.a.createElement(lt,null):"")),a.a.createElement(We,{show:e.loading,exitOptions:{position:"absolute"}},a.a.createElement(De.a,{className:t.loader})),a.a.createElement("div",{className:t.items},!e.loading&&e.items.map((function(e){return a.a.createElement(at,{key:e.id,item:e})}))),a.a.createElement(We,{show:e.items.length&&!e.loading},a.a.createElement(qe,null)))})),ft=n(121),gt=n.n(ft),vt=n(677),Et=n(290),bt=n.n(Et),yt=n(672),xt=n(628),kt=Object(xt.a)((function(e){return{error:{marginTop:e.spacing(1)}}})),Tt=function(e){var t=e.show,n=void 0===t||t,r=e.children,c=kt();return a.a.createElement(We,{show:n},a.a.createElement(yt.a,{error:!0,className:c.error},r))},wt=(n(621),Object(ye.a)((function(e){return{root:{width:"100%",minHeight:"200px",margin:e.spacing(2),padding:e.spacing(2),backgroundColor:e.palette.grey[100],boxSizing:"border-box",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative"},dragItem:{transition:"flex 0.15s, opacity 0.15s"},title:{fontWeight:700},items:{margin:"auto",width:"100%",zIndex:2,display:"grid",gridTemplateColumns:"100%","@media(min-width: 450px)":{gridTemplateColumns:"50% 50%"},"@media(min-width: 800px)":{gridTemplateColumns:"25% 25% 25% 25%"},"@media(min-width: 1024px)":{gridTemplateColumns:"20% 20% 20% 20% 20%"}},errorWrapper:{height:"20px",marginTop:"auto"},loader:{margin:"auto",alignSelf:"center"},placeholder:{margin:"-12px 0 0 0",position:"absolute",width:"100%",textAlign:"center",top:"50%"}}}))),St=function(e){var t=e.selectedItems,n=e.classes,r=e.isDragging;return t.map((function(e){return a.a.createElement(Fe.b.div,{positionTransition:r?null:{type:"tween"},key:e.id},a.a.createElement(at,{className:n.dragItem,item:e,variant:"removable"}))}))},Ot=function(e){var t=e.show,n=e.className;return a.a.createElement(We,{show:t,className:n,exitOptions:{position:"absolute",zIndex:3,top:"50%",marginTop:"-20px"}},a.a.createElement(De.a,null))},_t=function(e){var t=e.classes,n=e.noItemsText;return a.a.createElement(pt.a,{component:"div",variant:"body1",className:t.placeholder},a.a.createElement(vt.a,{fontWeight:"fontWeightLight"},n))},It=Object(ve.b)((function(e){return{selectedItems:e.selectedItems,SDK:e.SDK,params:e.params,touched:e.touched,backend:e.backend,initialised:e.initialised}}),{reorderItems:function(e){return function(t,n){t(function(e){return{type:"REORDER_SELECTED_ITEM",value:e}}(e));var r=n().selectedItems;t(te(r))}}})((function(e){var t=Object(r.useState)(!1),n=Object(Ze.a)(t,2),c=n[0],i=n[1],s=gt()(e.SDK,"field.schema",{}),o=s.minItems,u=s.maxItems,l=gt()(e.SDK,"form",{}).readOnly,p=wt({readOnly:l}),d=e.touched&&o&&e.selectedItems.length<o,h=e.touched&&u&&e.selectedItems.length>u,m=e.selectedItems.length?a.a.createElement(St,{selectedItems:e.selectedItems,classes:p,isDragging:c}):a.a.createElement(_t,{classes:p,noItemsText:e.params.noItemsText});return a.a.createElement(Te.a,{className:"selected-products "+p.root},a.a.createElement(pt.a,{variant:"subtitle1",component:"h2",className:p.title},gt()(e.SDK,"field.schema.title","Selected products")),a.a.createElement(Ot,{show:!e.initialised,className:p.loader}),a.a.createElement(We,{show:e.initialised},l&&a.a.createElement("div",{className:p.items},m),!l&&a.a.createElement(bt.a,{onChange:function(t,n,r){return e.reorderItems(r)},className:p.items,options:{animation:150,ghostClass:"product-placeholder",onStart:function(){return i(!0)},onEnd:function(){return i(!1)}}},m)),a.a.createElement("div",{className:p.errorWrapper},a.a.createElement(Tt,{show:Boolean(d)},"You must select a minimum of ",o," items"),a.a.createElement(Tt,{show:Boolean(h)},"You must select a maximum of ",u," items")))})),jt=Object(ye.a)((function(){return{root:{display:"flex",flexDirection:"column",alignItems:"center"},message:{display:"flex",alignItems:"center"},icon:{marginRight:ge.spacing(1)}}})),Ct=Object(ve.b)((function(e){return{globalError:e.globalError}}),{setGlobalError:ee})((function(e){var t=jt(),n=a.a.createElement("span",{className:t.message},a.a.createElement(be.a,{className:t.icon}),e.globalError);return a.a.createElement(xe.a,{className:t.root},a.a.createElement(ke.a,{anchorOrigin:{vertical:"top",horizontal:"center"},autoHideDuration:3e3,onClose:function(){return e.setGlobalError(null)},open:Boolean(e.globalError),message:n}),a.a.createElement(It,null),a.a.createElement(je,null),a.a.createElement(mt,null))}));n(622);me.dispatch(function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(),!(a=r.SDK)){e.next=3;break}return e.abrupt("return",a);case 3:return t(Q(!0)),e.prev=4,e.next=7,Object(h.a)();case 7:a=e.sent,t(oe(a)),t(m(a.params)),t(R()),c=n(),(i=c.params).catalogs.length&&t(se(i.catalogs[0].id)),t(function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n(),a=r.SDK,c=r.backend,t(Q(!0)),i=[],e.prev=4,e.next=7,a.field.getValue();case 7:if(s=e.sent,!(o=V()(s,(function(e){return!F()(e)})))||!o.length){e.next=16;break}return e.next=12,c.getItems(r,o);case 12:if(u=e.sent,$()(u)){e.next=15;break}throw new T("Field value is not an array",T.codes.INVALID_VALUE);case 15:i=u;case 16:(i=K()(i,(function(e){var t=e.id;return Z()(s,t)}))).length!==s.length&&t(te(i)),t({type:"SET_SELECTED_ITEMS",value:i}),t(Q(!1)),t(ae(!0)),e.next=29;break;case 23:e.prev=23,e.t0=e.catch(4),console.error("could not load",e.t0),t(Q(!1)),t(ae(!0)),t(ee("Could not get selected items"));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,n){return e.apply(this,arguments)}}()),s=n(),(o=s.params).catalogs.length!==i.catalogs.length&&t(se(o.catalogs[0].id)),t(Q(!1)),a.frame.startAutoResizer(),a.form.onReadOnlyChange((function(e){t(oe(Object(p.a)({},a,{form:Object(p.a)({},a.form,{readOnly:e})})))})),e.next=27;break;case 21:e.prev=21,e.t0=e.catch(4),console.error("Failed to load",e.t0),t(Q(!1)),t(ae(!0)),t(ee("Could not get SDK"));case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,n){return e.apply(this,arguments)}}());var Dt=function(){return a.a.createElement(ve.a,{store:me},a.a.createElement(Ee.a,{theme:ge},a.a.createElement(Ct,null)))};i.a.render(a.a.createElement(Dt,null),document.getElementById("root"))}},[[303,1,2]]]);
//# sourceMappingURL=main.9734cea0.chunk.js.map